Import "xy.luae"
Import "Cjson.lua"
Import "ShanHai.lua"
Import "zm.luae" //导入插件,只需执行一次
zm.Init()  //初始化插件,只需执行一次
zm.InitBase64 
Dim regToken = ""	//答题识别token
//初始化答题识别器
If Not zm.OcrBaiDuInit("yBqfGocbuDs4GlpO3TVyiczR", "cIZz2D3QUSRztn1tGUUoPP6234XoGELP") Then
    TracePrint "初始化答题识别失败"
    endReason = "初始化答题识别器失败"
    Delay 1000
    stopTheScript

End If

请求答题token 

Import "Find.lua"
Dim XYA()
Call Find.SetReturn(XYA)

'获得屏幕分辨率
Dim win_x,win_y,win_dpi
win_x = GetScreenX()
win_y = GetScreenY()
win_dpi = Device.GetDPI()
'计算屏幕比例值'原始比例720*1280
Dim win_w,win_h
win_w=win_x/720
win_h=win_y/1280
TracePrint "屏幕比例：" & win_w & ":" & win_h & ":" & win_dpi
If not (win_x = 720 and win_y = 1280 and win_dpi = 320) Then 
    endReason = "模拟器分辨率请设置为自定义:宽720,高1280,DPI320"
    stopTheScript
End If

Dim 返回数组()

'多点特征

//通用特征
Dim 网络波动() = 比例换算(Array(438,532,487,592,"82C5E2","11|2|82C5E2,11|-5|82C5E2,11|11|82C5E2,-3|6|1F2E48,3|6|1F2E48,-12|-2|82C5E2,-12|14|82C5E2,3|-3|1F2E48","网络波动"))
Dim 网络波动2() = 比例换算(Array(436,692,486,743,"82C5E2","11|2|82C5E2,11|-5|82C5E2,11|11|82C5E2,-3|6|1F2E48,3|6|1F2E48,-12|-2|82C5E2,-12|14|82C5E2,3|-3|1F2E48","网络波动"))
Dim 网络延迟() = 比例换算(Array(437,678,484,723,"82C5E2","-8|0|82C5E2,-9|5|1F2E48,-22|9|82C5E2,-22|20|82C5E2,-15|17|82C5E2,-8|8|82C5E2,1|20|82C5E2,-3|14|1F2E48,-7|20|82C5E2","网络延迟"))
Dim 出售() = 比例换算(Array(52,368,300,633,"974300","3|-7|CF780B,12|-7|EFA400,8|0|F3B04A,5|7|8F3D00,14|7|AB790F,17|0|E9D858","出售"))
Dim 战斗准备() = 比例换算(Array(302,305,357,398,"ADE9F8","-22|-4|ADE9F8,-2|12|ADE9F8,-24|18|ADE9F8,-4|33|A8E4F3,-10|37|022741,-25|44|ADE9F8,-28|44|022741,-16|51|AAE6F5,-13|47|022741","战斗准备"))
Dim 失败() = 比例换算(Array(556,557,652,648,"34E2D5","15|0|34FDFD,22|-17|31FFFF,-1|-25|32E0D2,-24|-24|33AC89,-23|22|32AE8C,0|23|3EE5D8","失败"))
Dim 答题沙漏() = 比例换算(Array(465,911,505,942,"76B9F1-101010","1|0|485D87-101010,2|0|1B75AA-101010,3|0|0AB1F9-101010,13|0|55ADE2-101010,16|0|1F4872-101010,17|0|166DA8-101010,18|0|83C6E7-101010","答题沙漏"))
Dim 确认框是() = 比例换算(Array(252,488,309,578,"409BC8-101010","-9|11|ADE9F8-101010,0|11|113851-101010,2|11|ADE9F8-101010,5|11|022741-101010,15|12|072C46-101010,-8|23|ADE9F8-101010,11|32|A5E0EF-101010,11|34|022741-101010,2|35|ADE9F8","确认框是"))
Dim 白色六星() = 比例换算(Array(456,388,497,524,"0E1825-101010","1|12|F4F5F3-101010,1|24|F3F4F1-101010,1|35|F3F4F2-101010,1|46|F4F5F2-101010,1|58|F0F2EF-101010,1|69|F1F2F0-101010,-1|89|0E1825-101010","白色六星"))


//判断模式
Dim 巨人模式() = 比例换算(Array(665,70,718,161,"285481","13|-12|CFEEF1,-13|-12|8B9FA1,-14|12|869A9C,14|13|CFEEF1,13|35|CFEEF1,2|26|60A9D0,-13|22|8B9FA1,-12|45|8FA5A7","巨人模式"))
Dim 龙模式() = 比例换算(Array(665,70,718,161, "102D5D","9|-11|CFEEF1,8|15|CFEEF1,18|0|112E5E,-11|-10|8FA5A7,-5|4|ACC6C8,-13|11|869A9C,-8|16|9EB5B7,-3|13|102D5D,5|8|102D5D","龙模式"))
Dim 死亡模式() = 比例换算(Array(665,70,718,161, "C2E0E5","11|-13|CFEEF1,11|16|CEECF0,-3|-13|BEDADD,0|-6|112F5F,-14|-10|8B9FA1,-15|-1|478DBE,-14|5|8B9FA1,-10|16|9EB5B7,-1|16|102D5D","死亡模式"))
Dim 火异界() = 比例换算(Array(404,983,549,1128,"010867","31|1|172FAB,35|-25|1A73AB,10|-28|0731E7,-24|-30|2CFFFF,-23|-3|1733D7,-23|17|050A4B,-4|19|519DED,17|21|1973B3,-53|-16|BCFBFD","火异界" ))
Dim 水异界() = 比例换算(Array(404,983,549,1128,"DC8B1E","25|1|FCE568,4|-22|33080C,30|-9|7B3814,-37|-38|FDF2F2,-34|4|6E4813,-35|23|7E4C1C,-10|22|F2E84C,16|27|EC820B","水异界" ))
Dim 风异界() = 比例换算(Array(667,289,716,342,"1E3345-101010","6|-5|1E3345-101010,5|3|1E3345-101010,-6|-5|1E3345-101010,-5|3|1E3345,7|-1|6FB8DA,12|-9|1E3345,12|8|1E3345,-8|0|62AAD1,-7|13|1E3345","风异界" ))
Dim 光异界() = 比例换算(Array(404,983,549,1128,"94BCD0","9|-39|C5DCE4,32|-9|7CBEDC,44|18|D3F9FC,42|-32|6C8199,-29|8|7E6734,3|30|86A3BB,27|21|6A7F98,-40|-32|BEC87E,-21|-6|102654","光异界" ))
Dim 暗异界() = 比例换算(Array(404,983,549,1128,"AF3D3C","24|-13|B4C81D,22|8|34380A,19|21|0E0F03,-33|-29|FDE6A9,-32|4|5B4E46,-44|8|F66CB9,-56|22|A9B51E,-25|35|A96659,9|-41|36221E","暗异界" ))
Dim 爬塔模式() = 比例换算(Array(663,69,719,151,"CFEEF1","-7|1|102D5D,-15|1|C1DEE1,-25|1|94AAAC,-5|10|CFEEF1,-24|12|99AFB2,-18|15|102E5E,-28|23|869A9C,-13|19|C8E6E9,-15|22|102D5D","爬塔模式"))
Dim 魔力地下() = 比例换算(Array(384,893,548,1045,"7EABF0","-1|-21|BA8F53,-10|-17|80DFD9,3|15|301FA6,22|18|70CDF6,9|34|F2F2CC,-30|27|303359,-27|0|7688AD,-45|7|4C4A45,17|-33|9D9D95","魔力地下"))
Dim 异界突袭() = 比例换算(Array(658,120,718,179,"C8E6E9","6|0|102D5D,10|0|CFEEF1,10|-11|CFEEF1,7|-9|102D5D,3|11|CFEEF1,-2|11|B7D3D9,-11|8|92A8AA,-5|6|1F3C68,-3|-11|BCD9DB","异界突袭"))
Dim 竞技场() = 比例换算(Array(658,64,717,147,"C8E6E9","7|1|102D5D,5|1|CFEEF1,14|0|C9E8EC,-4|-5|102D5D,-4|10|BAD6D8,-16|-13|829597,-14|5|8B9FA1,-12|15|94AAAC,-12|8|102D5D","竞技场"))
Dim 精髓地下() = 比例换算(Array(665,147,717,240,"C8E6E9","12|-12|CFEEF1,12|1|CFEEF1,12|15|CFEEF1,0|-11|6BB6D7,-12|-11|57A0CA,-14|0|8B9FA1,-5|11|B5D1D3,4|10|69B6DA,-15|10|519BC5","精髓地下"))

//重启游戏特征
Dim 首页战斗() = 比例换算(Array(16,659,141,773,"62899C","18|-21|D3E6F1,-17|17|12A8D7,-21|31|0B1D53,-29|36|41D0FD,-28|-35|0DBAED,20|25|ADCEDB,-8|-26|0F7191,-11|-8|4A707B,13|33|031F43","首页战斗"))
Dim 卡伊洛斯() = 比例换算(Array(36,550,100,622,"C9E4EE","9|-12|7CB0BE,-3|-6|00068D,-3|6|00068F,18|-2|99ECFD,2|8|74A6B5","卡伊洛斯"))
Dim 列表巨人() = 比例换算(Array(22,150,558,330,"64F8FF","19|-3|6766FE,29|-8|E5F8FF,-3|-21|232349,27|34|1E1DFA,41|-24|67DAFE,15|28|2F34A0,-18|60|1B339E,15|-34|3237C7,-24|-19|21242F","列表巨人"))
Dim 巨人十层() = 比例换算(Array(21,512,178,689,"FFD01D","-12|-28|A76B11,-10|-13|FFECCD,31|38|0CD0FD,-43|-31|F89000,34|51|000102,-2|39|63360D,-39|26|E0F0F8,-37|0|FFED1E,-7|75|5988A7","巨人十层"))
Dim 列表龙() = 比例换算(Array(22,150,558,330,"746872","25|-1|DFAF48,28|-15|DBD5DF,42|-13|A85418,10|-26|3981B4,-20|6|7C808C,47|52|4C4E48,30|9|5D3D04,-8|-37|480835,-20|38|8E3B0C","列表龙"))
Dim 龙十层() = 比例换算(Array(21,512,178,689,"3043D3","-4|-6|D1DBFD,10|-31|90ABD7,37|22|0CD0FD,41|35|010D11,11|42|EAFFFF,-28|12|E0F0F8,-43|-6|586873,0|60|547F9B","龙十层"))
Dim 列表死亡() = 比例换算(Array(22,150,558,330,"643655","10|-26|394EAF,8|-58|9D578E,32|-58|848C90,-18|-36|DCC6D6,41|8|62C2F0,34|-24|531D3A,-25|25|3375A3","列表死亡"))
Dim 死亡十层() = 比例换算(Array(21,512,178,689,"325DA9","33|14|0CD0FD,36|27|010D11,28|30|8F9D22,14|36|DCEABA,6|-13|301D30,17|-38|E2F0C4,5|-55|5E3A4A,11|50|5A89A7","死亡十层"))
Dim 活动叉() = 比例换算(Array(6,1024,136,1247,"888888","14|-13|828282,14|15|848484,-13|14|828282,-13|-13|878787,0|-6|E5E5E5,9|1|E8E8E8,1|9|E5E5E5,-10|0|E1E1E1,-35|42|030303","活动叉"))
Dim 广告叉() = 比例换算(Array(520,980,715,1200,"E0F0F8","14|-10|657C87,-8|-9|DFEFF6,-9|8|E0F0F8,14|6|768C97,21|0|10364B,2|12|10364B,-25|-1|205776,0|-23|11374D,21|27|1F5775","广告叉"))
//Dim 确认框是() = 比例换算(Array(214,472,270,585,"457389","12|-7|ADE9F8,7|1|ADE9F8,3|11|ADE9F8,-2|-11|ADE9F8,-1|14|A0DAEA,-7|-3|022741,-13|-6|032842,-9|-7|ADE9F8,-14|14|A8E3F2","确认框是"))
Dim 开始游戏() = 比例换算(Array(449,600,530,679,"ACCCD6","0|-12|A6C7D2,-1|13|B5D5DE,3|10|B5D3DD,4|-8|BDDCE4,-14|0|B3D3DF,-17|0|07112A,-31|0|A7CAD6,22|0|BEDBE4","开始游戏"))

//地下城下城循环
Dim 开始战斗() = 比例换算(Array(165,1004,258,1162,"66CDF7","6|-8|1C2530,-21|-7|1C2430,-37|-36|ADE9F8,-13|-49|4AA5D0,-34|-28|022741,-59|-22|7AA5AF,-55|-4|8DBECA,-11|8|2889C5,-45|4|ADE9F8","开始战斗"))
Dim 非自动() = 比例换算(Array("48|235|FFFFFF,37|227|FFFFFF,58|226|FFFFFF,47|245|FFFFFF"))
Dim 小boss() = 比例换算(Array(586,22,644,88,"293452","0|-10|293553,1|10|293553,11|0|DAEFF9,0|-18|C9DFEA,-9|-3|B6D4DF,1|18|BFDDE7,-5|-17|CFE8F3,10|7|DFF3FD,2|19|C5DFEB","小boss"))
Dim 材料() = 比例换算(Array(452,828,630,900,"337CAC","11|-8|4593BD,-7|9|2870A2,-10|-8|22679B,10|10|4594BC,1|10|0E1825,13|1|0E1825,1|-10|0E1825,-12|1|0E1825","材料"))
Dim 再来一次() = 比例换算(Array(300,291,356,411,"ADE9F8","-17|1|ADE9F8,-17|21|ADE9F8,0|22|ADE9F8,-12|31|ADE9F8,-15|35|022741,-22|30|ADE9F8,-27|42|022741,-12|58|022741,-12|55|ADE9F8","再来一次"))
Dim 体力不足() = 比例换算(Array(246,695,304,770,"ADE9F8","1|-14|439ECD,7|-7|022741,9|4|ADE9F8,10|10|ADE9F8,-10|10|ADE9F8,-13|10|032842,5|13|022741,-11|1|A4DFEF,-8|14|022741","体力不足"))
Dim 邮箱体力不足() = 比例换算(Array(246,695,304,770,"56747C","1|-14|214F66,7|-7|011320,9|4|56747C,10|10|56747C,-10|10|56747C,-13|10|011421,5|13|011320,-11|1|526F77,-8|14|011320","邮箱体力不足"))
Dim 胜利() = 比例换算(Array(549,550,661,664,"33FEFF","8|-24|35FFFF,-13|-24|86F4FF,-40|-27|03B9FF,-43|-2|03B5FF,-43|14|04B5FF,8|1|2EFFFF,-20|14|B1F3FF,8|20|0F2C5C,-38|1|0C1D4C","胜利"))
Dim 翻车() = 比例换算(Array(230,374,274,417,"4A1AD9","-8|0|794AF5,-3|-7|BA88FF,7|-1|E8D9FF,5|7|7F3FFF,-7|7|2E078E","翻车"))
//Dim 失败() = 比例换算(Array(560,554,648,649,"34FCFB","7|-17|33FFFF,11|0|30FFFF,1|18|39FFFE,-16|-1|33DDCF,-15|-26|33E3D5,-15|22|33E0D3,-38|-24|33AC89,-35|17|2FB08F,-20|-11|083A3D","失败"))
Dim 秘密地下() = 比例换算(Array(563,743,652,833,"21EAFF","21|-21|31FFFF,22|19|55FFFF,0|20|7FF9FF,4|-20|3EF2FF,-26|-24|06B9FF,-27|-1|0ABAFF,-28|27|02B5FF,-14|12|102859","秘密地下"))
Dim 次元开始战斗() = 比例换算(Array(165,1004,258,1162,"0824DA","12|-2|0265E0,21|-1|DBF8FF,14|-5|4ECEFF,22|6|3DCDFD,17|7|014CE3,29|1|180C1F,-6|-3|1C1A24","次元开始战斗"))

//爬塔模式
Dim 下一层() = 比例换算(Array(296,426,363,490,"67CEF7","5|3|6AD3FA,-6|2|66CEF7,-7|8|2989C6,-2|5|298AC7,10|4|D0FCFC","下一层"))

//异界地下模式
Dim 确认() = 比例换算(Array(97,627,156,681,"ADE9F8","13|0|ADE9F8,12|-3|022741,13|3|032842,7|-4|ACE8F7,-4|3|ADE9F8,-4|12|022741,15|12|ADE9F8,-7|19|ADE9F8,0|10|ADE9F8","确认"))
Dim 进行战斗() = 比例换算(Array(92,848,171,955,"A9E5F4","-22|-1|A9E5F4,-22|21|A9E5F4,-11|11|A9E5F4,-3|11|A9E5F4,-31|8|113698,10|8|245BB9","进行战斗"))


//竞技场模式
//Dim 翅膀() = 比例换算(Array(82,988,589,1033,"FEF7F4","-3|3|102440,10|12|F5F1F0,6|14|21354E,3|15|FFFFFF,-4|13|BED1D0,-7|1|FFF7F6,0|-3|102441,8|1|50ACD4","翅膀"))
Dim 翅膀() = 比例换算(Array(88,966,586,1085,"0E354E-101010","0|3|A2DDED-101010,0|13|A4DEEE-101010,0|15|022741-101010,-9|50|0D334C-101010,-6|50|ADE9F8-101010,18|50|ADE9F8-101010,35|43|FDFDFD-101010,38|4|FFF9F9-101010,50|44|FDFCFD-101010","翅膀"))
Dim 翅膀反击() = 比例换算(Array(88,966,586,1085,"1E4C7A-101010","-1|25|092F48-101010,-11|31|022741-101010,-15|39|ADE9F8-101010,-6|40|072C46-101010,-3|46|ADE9F8-101010,-6|56|ADE9F8-101010,-6|80|ADE9F8-101010,29|70|FDFDFD-101010,25|32|FFF3F0-101010","翅膀反击"))
Dim 竞技场刷新等待() = 比例换算(Array(519,882,621,986,"E5F1F6-101010","17|0|E3F2F8-101010,3|12|E1F1F8-101010,10|7|E0F2F7-101010,16|13|E2F0F8-101010,38|3|326F8E-101010,-16|2|1E5472-101010","竞技场刷新等待"))


Dim 竞技场列表() = 比例换算(Array(577,475,661,673,"233B51","7|1|5F9DBE,1|7|43607B,7|7|3A789A,7|-33|548399,8|115|E0F0F8,11|115|0D2540,14|116|E0F0F8","竞技场列表"))
Dim 竞技场开始战斗() = 比例换算(Array(203,1016,265,1119,"FFF6F4","4|-2|0E223E,1|6|C9D8D6,16|18|E2E8E8,2|17|FEFEFE,5|17|0D223F,-3|17|10233F,-7|16|C3D4D2,-6|2|102440,-9|6|9DBDBD","竞技场开始战斗"))
Dim 对话框() = 比例换算(Array(0,0,30,30,"ABC3CD","-2|4|ACC9D5,12|-2|9FC3D1,-2|15|A4CFE1,3|8|0B1114,4|5|0A1115,8|2|0A1014,8|8|111618","对话框"))
Dim 符文不全() = 比例换算(Array(437,662,486,708,"1F2E48-101010","-6|0|82C5E2-101010,-15|0|1F2E48-101010,-21|0|82C5E2-101010,-21|22|82C5E2-101010,-14|22|1F2E48-101010,-14|19|82C5E2-101010,-11|22|1F2E48-101010,-5|21|82C5E2-101010,3|11|82C5E2-101010","符文不全"))

//狗粮模式
Dim 狗粮战斗准备() = 比例换算(Array(301,329,359,399,"ADE9F8","10|-10|022741,6|-11|ADE9F8,-1|-11|ACE7F7,16|0|ADE9F8,-7|0|ADE9F8,1|6|ACE8F7","狗粮战斗准备"))

Dim 黄色一星狗粮上() = 比例换算(Array("0CD0FD","3|-14|4BA7D7,16|1|4BA7D7,4|3|13D2FD,3|9|32D8FD,3|15|000405","黄色一星狗粮上"))

Dim 黄色一星狗粮下() = 比例换算(Array("0CD0FD","16|0|214963,1|-12|214963,4|2|0ECFFB,-5|5|0ABAEE,2|13|16060F","黄色一星狗粮下"))
Dim 白色一星狗粮下() = 比例换算(Array("EFF0ED","-3|-14|214963,14|-1|214963,-1|3|E3E2DE,-7|3|B5B0A7,1|12|181511","白色一星狗粮下"))
Dim 红色一星狗粮下() = 比例换算(Array("FA58FC","-4|-14|214963,12|2|214963,-8|2|AD34E2,-3|4|AC3AE2,-1|12|000203","红色一星狗粮下"))

Dim 黄色二星狗粮下() = 比例换算(Array("04181C","-5|-3|0CD0FD,-5|-13|214963,11|0|214963,0|13|0FCDFA,-3|16|11D1FD,-1|25|050506","黄色二星狗粮下"))
Dim 白色二星狗粮下() = 比例换算(Array("1C1C1B","-4|-3|F3F4F2,-4|-13|214963,12|-1|214963,0|13|F1F2F0,-3|18|CBC9C3,-2|24|10100F","白色二星狗粮下"))
Dim 红色二星狗粮下() = 比例换算(Array("1C0B1D","-5|-2|FE3DFF,-5|-13|214963,12|-1|214963,0|13|F741FB,-3|17|AC39E0,-2|24|020F15","红色二星狗粮下"))

Dim 黄色三星狗粮下() = 比例换算(Array("071316","-4|-4|0CD0FD,-4|-14|214963,11|0|214963,0|25|11CEFA,-3|27|0ED0FD,0|12|03232B,-5|9|0CD0FD","黄色三星狗粮下"))
Dim 红色三星狗粮下() = 比例换算(Array("FF4BFF","0|-11|214963,15|2|214963,0|13|FF43FF,0|27|FF3DFF,3|40|04111A","红色三星狗粮下"))

Dim 黄色四星狗粮下() = 比例换算(Array("0CD0FD","0|-10|214963,15|3|214963,0|13|0CD0FD,0|25|0CD0FD,4|42|0DCCF9,3|54|231007","黄色四星狗粮下"))
Dim 红色四星狗粮下() = 比例换算(Array("FF40FF","4|3|160B16,0|-11|214963,15|2|214963,0|13|FF38FF,0|26|FF39FF,5|41|E432F4,1|51|010609","红色四星狗粮下"))

Dim 黄色五星狗粮下() = 比例换算(Array("042B34","-5|-2|0CD0FD,-5|-13|214963,11|3|214963,-5|10|0CD0FD,-5|36|0CD0FD,0|51|12CFFB,-1|63|00070A","黄色五星狗粮下"))
Dim 红色五星狗粮下() = 比例换算(Array("341634","-5|-2|FE40FF,-5|-13|214963,11|0|214963,0|13|1B0B1C,-4|24|FF3BFF,-4|36|FF3CFF,0|52|F339F9,-1|63|01060A","红色五星狗粮下"))

//黄色6星暂未采集
Dim 黄色六星狗粮下() = 比例换算(Array("042B34","-5|-2|0CD0FD,-5|-13|214963,11|3|214963,-5|10|0CD0FD,-5|36|0CD0FD,0|51|12CFFB,-1|63|00070A","黄色六星狗粮下"))
Dim 红色六星狗粮下() = 比例换算(Array("1B0A1B","-4|-2|FF39FF,-4|-14|214963,-4|24|FF3DFF,-1|25|190C19,-3|49|FD43FD,0|64|F534FA,-1|76|160510","红色六星狗粮下"))


//突袭模式
Dim 等待队友() = 比例换算(Array(40,1116,97,1174,"56747C","0|12|56747C,-9|9|537077,-9|0|537077,-17|-3|3F555B,-18|9|3D5257,-9|-6|537077,-9|15|537077,-2|4|031623","等待队友"))
Dim 战斗开始() = 比例换算(Array(38,1116,99,1178,"ADE9F8","-9|-6|A6E0EE,-9|14|A6E0EE,0|11|ADE9F8,-9|5|A6E0EE","AFEBFB","-9|-6|A8E2F1,-9|12|ADE7F6,0|12|B2EEFE,-9|5|ABE5F3","战斗开始"))
Dim 战斗中() = 比例换算(Array("20|14|FFFFFF,75|14|FFFFFF,78|77|FFFFFF,16|77|FFFFFF,35|34|FFFFFF,59|61|FFFFFF,35|62|FFFFFF,59|32|FFFFFF,15|46|FFFFFF,80|48|FFFFFF"))
Dim 需要准备() = 比例换算(Array(40,1116,97,1174,"ADE9F8","3|-1|0C324C,7|-1|ADE9F8,2|-11|ADE9F8,2|9|ADE9F8,-12|10|7AA4AE,-10|2|84B2BE,-5|-10|9ED5E3","需要准备"))
Dim 已经准备() = 比例换算(Array(40,1116,97,1174,"ACE7F7","-2|6|ACE8F7,-14|0|8ABAC6,-13|7|8FC1CD,-18|19|749DA7,-13|19|8FC1CD,-7|19|A3DEEC,-2|19|ADE9F8","已经准备"))
Dim 突袭确认() = 比例换算(Array(260,634,310,682,"ADE9F8","-8|-4|ADE9F8,-22|1|ADE9F8,-24|7|ADE9F8,-24|22|ADE9F8,-21|15|022741,1|14|ADE9F8","确认"))
Dim 无队长技() = 比例换算(Array(438,649,488,692,"1F2E48-101010","0|6|82C5E2-101010,0|16|82C5E2-101010,-5|6|22334D-101010,-9|6|82C5E2-101010,-14|5|82C5E2-101010,-16|5|1F2E48-101010,-21|5|82C5E2-101010,-25|14|80C2DF-101010,-24|24|81C3E0","无队长技"))



//动态图数据(3组)
Dim 突袭战斗开始() = Array("73|1141|ADE9F8,64|1142|A6E0EE,64|1151|A6E0EE,73|1151|ADE9F8,56|1151|7FABB6,56|1139|7FAAB6","73|1141|ADE9F8,64|1142|A8E0EE,64|1151|ACE7F8,73|1151|AEE9F8,56|1151|83AFBE,56|1139|7FAAB6","73|1141|ADE9F8,64|1142|A6E0EE,64|1151|A6E0EE,73|1151|ADE9F8,56|1151|7FABB6,56|1139|7FAAB6","突袭战斗开始")


Randomize
Log.Open 
Dim setWords
//将附件中的紫猫学院字库.txt设置为0号字库
setWords = SetDictEx(0, "Attachment:识别.txt")
TracePrint "0号字库设置结果:", setWords
setWords = UseDict(0)
TracePrint "切换0号字库设置结果:", setWords
SetRowsNumber(0)

//定义统计相关信息
//闯关成功次数,失败次数,购买体力次数,答题正确次数,错误次数,橙色6星,橙色5星,紫色六星,紫色五星,蓝色六星,蓝色石头，紫色石头，橙色石头
Dim success=0,failure=0,buyTimes=0,answerTrue=0,answerFalse=0,C6=0,C5=0,Z6=0,Z5=0,L6 = 0,SL = 0,SZ = 0,SC = 0,蓝色神器数=0,紫色神器数=0,橙色神器数=0
Dim falseTime = 0	//当前答题错误次数
Dim x,y,i
//获取UI界面设置信息

//战斗次数,买体次数,翻车次数,脚本模式,符文精炼石选留设置
Dim regCode = ReadUIConfig ("注册码内容","0")

Dim totalBuyTimes = CInt(ReadUIConfig("买体次数输入框",999))
Dim totalFailedTimes =  CInt(ReadUIConfig("翻车次数输入框",999))
Dim totalTimes =  CInt(ReadUIConfig("战斗次数输入框",999))

Dim type = -1
Dim isChoose5Z = ReadUIConfig("5Z", true)
Dim isChoose5C = ReadUIConfig("5C", true)
Dim isChoose6L = ReadUIConfig("6L", true)
Dim isChoose6Z = ReadUIConfig("6Z", true)
Dim isChooseALL = ReadUIConfig("ALL", false)
Dim isSpeed = ReadUIConfig("速度", false)

Dim isTuTuL = ReadUIConfig("蓝色精炼",true)
Dim isTuTuZ = ReadUIConfig("紫色精炼",true)
Dim isMusic = ReadUIConfig("isMusic",true)
Dim isMimi = ReadUIConfig("秘密地下",false)
//狗粮模式相关UI和变量
Dim star1Finished = False	
Dim star2Finished = False
Dim star3Finished = False
Dim star4Finished = False
Dim isFriend = False
Dim isScrollEnd = False	//换狗粮时是否已经滑动到最右



Dim currentTimeResult = True 	//当前一把是赢还是输
Dim intP,intQ	//自定义找图返回坐标


Dim currentVersion = 14	//当前版本号



判断文件
Dim dirPath= GetSdcardDir() & "/taidi"
TracePrint Dir.Create(dirPath & "/mlzh/logs")
dim LogFileName = dirPath & "/mlzh/logs/" & GetNetworkTime() & ".txt"

TracePrint "日志记录开始"

Dim errorStr = "如有疑问，请加群838134503联系泰迪~"
Dim endReason = "用户手动停止~"
Dim json, table, ver,detail,link,code,startTime,endTime


// 黄色差6星
//"0CD0FD",
dim findPicTb = {_
"主属性百分比": {"起点颜色": "DED3DE-202020", "偏移":"4|4|C6B4C6-202020,1|7|E3DAE3-202020,-4|4|E1D7E1-202020,-13|5|E7DFE7-202020,1|14|E0D6E0-202020,-12|11|E9E2E9-202020,-8|15|E1D8E1-202020,-12|18|EDE7ED-202020,-16|15|CCBCCC-202020"},_
"主属性速度": {"起点颜色": "EEECE9-202020", "偏移":"-11|0|FAFAF9-202020,4|11|FBFBFA-202020,3|20|D0C9C2-202020,-3|8|FFFFFF-202020,-3|17|F9F8F7-202020,-12|7|FFFFFF-202020,-12|19|FFFFFF-202020,-18|13|FFFFFF-202020"},_
"速度": {"起点颜色": "7EC5DB-202020", "偏移":"0|5|6FAEC3-202020,0|10|80C8DF-202020,-5|5|80C8DF-202020,-7|-1|79BED4-202020,-7|11|7EC5DC-202020"},_
"成绩结算": {"起点颜色": "8AFEFF-202020", "偏移":"0|38|76FFFF-202020,-31|-8|4DD3FE-202020,-11|13|2BEAFD-202020,-31|16|7CDDFC-202020,-15|23|30E8FB-202020,-36|32|0690F1-202020"},_
"蓝色水晶": {"起点颜色": "EFA400-202020", "偏移":"-10|1|CF780B-202020,-4|6|F5B852-202020,5|7|E9D858-202020,-6|14|893900-202020"},_
"黄色狗粮六星": {"起点颜色": "0CD0FD-202020", "偏移":"-1|15|0CD0FD-202020,-1|31|0CD0FD-202020,-1|46|0CD0FD-202020,-2|62|0CD0FD-202020,-1|79|0CD0FD-202020,2|87|18C8F6-202020"},_
"黄色狗粮五星": {"起点颜色": "0CD0FD-202020", "偏移":"0|16|0CD0FD-202020,0|30|0CD0FD-202020,0|46|0CD0FD-202020,0|63|0CD0FD-202020,2|72|12BFF0-202020"},_
"黄色狗粮四星": {"起点颜色": "0CD0FD-202020", "偏移":"2|15|0CD0FD-202020,1|32|0CD0FD-202020,1|47|0CD0FD-202020,5|62|00090C-202020"},_
"黄色狗粮三星": {"起点颜色": "0CD0FD-202020", "偏移":"1|16|0CD0FD-202020,3|20|03090A-202020,3|36|18D3FD-202020,3|41|37DAFD-202020,5|47|070C0C-202020"},_
"黄色狗粮二星": {"起点颜色": "0CD0FD-202020", "偏移":"3|5|091C20-202020,-1|17|0CD0FD-202020,3|21|1DD4FD-202020,2|26|2ED4FB-202020,1|31|0D0D0C-202020"},_
"黄色狗粮一星": {"起点颜色": "0CD0FD-202020", "偏移":"3|5|19D3FD-202020,2|11|28D1FA-202020,2|16|000A0D-202020"},_
"红色狗粮六星": {"起点颜色": "FF3BFF-202020", "偏移":"0|16|FF3DFF-202020,0|31|FF3DFF-202020,0|46|FF3CFF-202020,0|62|FF3DFF-202020,0|77|FF3DFF-202020,2|86|AB3EDD-202020"},_
"红色狗粮五星": {"起点颜色": "FF3BFF-202020", "偏移":"0|16|FF3DFF-202020,0|31|FF3DFF-202020,0|46|FF3CFF-202020,0|62|FF3DFF-202020,2|70|B552E3-202020"},_
"红色狗粮四星": {"起点颜色": "FF3DFF-202020", "偏移":"0|16|FF3FFF-202020,0|32|FF40FF-202020,0|47|FF40FF-202020,3|56|B24DE1-202020,3|61|01080B-202020"},_
"红色狗粮三星": {"起点颜色": "FF3BFF-202020", "偏移":"0|16|FF3DFF-202020,0|31|FF3DFF-202020,2|40|AD40DF-202020,3|46|080206-202020"},_
"红色狗粮二星": {"起点颜色": "FF3BFF-202020", "偏移":"0|16|FF3DFF-202020,-6|21|9D2ED4-202020,2|24|B655E4-202020"},_
"红色狗粮一星": {"起点颜色": "FE3FFF-202020", "偏移":"3|4|F059FA-202020,3|9|B34CE2-202020,3|14|02090F-202020"},_
"白色狗粮四星": {"起点颜色": "EFF0EE-202020", "偏移":"0|15|F0F1EF-202020,0|30|F1F2EF-202020,0|47|EDEDEA-202020,2|60|080707-202020"},_
"白色狗粮三星": {"起点颜色": "EFF0EE-202020", "偏移":"0|15|F0F1EF-202020,0|32|ECECE9-202020,2|38|D9D8D2-202020,2|45|030305-202020"},_
"白色狗粮二星": {"起点颜色": "F3F4F1-202020", "偏移":"3|4|181717-202020,2|20|EEEFED-202020,2|25|E7E5E1-202020,3|31|1D1C1B-202020"},_
"白色狗粮一星": {"起点颜色": "F0F1EF-202020", "偏移":"-6|3|C9C6BE-202020,6|1|E8E8E6-202020,1|6|E7E6E3-202020,1|14|010109-202020"},_
"黄色狗粮六星下": {"起点颜色": "0CD0FD-202020", "偏移":"0|16|0CD0FD-202020,-1|31|0CD0FD-202020,-1|47|0CD0FD-202020,0|62|0CD0FD-202020,3|65|030708-202020,3|82|29D7FD-202020,2|88|29C2EF-202020,3|92|04222D-202020"},_
"黄色狗粮五星下": {"起点颜色": "0CD0FD-202020", "偏移":"0|12|0CD0FD-202020,0|25|0CD0FD-202020,0|37|0CD0FD-202020,0|51|0CD0FD-202020,2|58|25D0FA-202020,2|63|060707-202020"},_
"黄色狗粮四星下": {"起点颜色": "0CD0FD-202020", "偏移":"0|12|0CD0FD-202020,0|24|0CD0FD-202020,0|37|0CD0FD-202020,-5|41|0BC2F4-202020,1|43|0BC3F4-202020,2|50|010106-202020"},_
"黄色狗粮三星下": {"起点颜色": "0CD0FD-202020", "偏移":"0|12|0CD0FD-202020,0|26|0CD0FD-202020,-6|30|09AFE6-202020,1|32|08A6E0-202020,2|38|0A0A0B-202020"},_
"黄色狗粮二星下": {"起点颜色": "0CD0FD-202020", "偏移":"-6|-1|0DAAE3-202020,0|14|0CD0FD-202020,2|7|42D9FC-202020,-5|18|0BC4F5-202020,2|22|15C3F2-202020,3|27|040404-202020"},_
"黄色狗粮一星下": {"起点颜色": "0CD0FD-202020", "偏移":"16|0|214963-202020,1|-12|214963-202020,4|2|0ECFFB-202020,-5|5|0ABAEE-202020,2|13|16060F-202020"},_
"红色狗粮六星下": {"起点颜色": "FF3FFF-202020", "偏移":"0|13|FF3DFF-202020,0|25|FF3DFF-202020,0|37|FF3CFF-202020,0|49|FF3CFF-202020,0|62|FF3EFF-202020,2|74|030203-202020"},_
"红色狗粮五星下": {"起点颜色": "FF3EFF-202020", "偏移":"0|12|FF3DFF-202020,0|24|FF3DFF-202020,0|36|FF3CFF-202020,0|49|FF3EFF-202020,2|61|070705-202020"},_
"红色狗粮四星下": {"起点颜色": "FF3EFF-202020", "偏移":"0|12|FF3DFF-202020,0|24|FF3DFF-202020,0|37|FF3EFF-202020,-5|40|A230D9-202020,2|49|050505-202020"},_
"红色狗粮三星下": {"起点颜色": "FF3CFF-202020", "偏移":"0|12|FF3BFF-202020,0|25|FF3EFF-202020,-4|29|A32FDA-202020,2|32|B552E3-202020,2|37|040203-202020"},_
"红色狗粮二星下": {"起点颜色": "FF3AFF-202020", "偏移":"0|13|FF3EFF-202020,2|20|BA5FE5-202020,-4|17|A832DE-202020,2|25|03070C-202020"},_
"红色狗粮一星下": {"起点颜色": "FF3DFF-202020", "偏移":"-6|-3|B54DE4-202020,-6|4|A430DA-202020,1|6|BA65E6-202020,1|13|030202-202020"},_
"白色狗粮四星下": {"起点颜色": "F2F3F1-202020", "偏移":"0|12|F3F4F1-202020,0|24|F3F4F1-202020,0|39|EBEBE9-202020,2|45|DFDEDA-202020,2|51|07080D-202020"},_
"白色狗粮三星下": {"起点颜色": "F1F2EF-202020", "偏移":"0|11|F3F4F1-202020,0|25|EFEFED-202020,2|32|E1E0DB-202020,2|38|010203-202020"},_
"白色狗粮二星下": {"起点颜色": "F3F4F1-202020", "偏移":"0|14|EEEFEC-202020,-4|18|C3BEB6-202020,2|21|E0DFDA-202020,2|27|090600-202020"},_
"白色狗粮一星下": {"起点颜色": "F1F2F0-202020", "偏移":"-6|4|B9B4AB-202020,1|7|DEDDD8-202020,1|13|03031B-202020"},_
"1": {"起点颜色": "E0F0F8-202020", "偏移":"0|3|E0F0F8-202020,-5|3|E0F0F8-202020,-9|3|CDDCE3-202020,-14|3|A3AFB4-202020"},_
"2": {"起点颜色": "E0F0F8-202020", "偏移":"3|4|E0F0F8-202020,-1|9|E0F0F8-202020,0|5|0D2540-202020,-7|6|CFDEE5-202020,-13|1|9DA8AE-202020,-14|9|949FA4-202020,-11|7|0D2540-202020"},_
"3": {"起点颜色": "E0F0F8-202020", "偏移":"2|5|E0F0F8-202020,-2|9|E0F0F8-202020,-6|4|DBEBF2-202020,-2|3|0E2641-202020,-11|6|0D2540-202020,-11|9|B7C4CB-202020,-15|5|949FA4-202020,-12|0|AEBBC1-202020"},_
"4": {"起点颜色": "E0F0F8-202020", "偏移":"-3|-4|DEEEF7-202020,-7|-6|D5E4EC-202020,-11|-8|B8C5CB-202020,-11|0|B8C5CB-202020,-15|0|939EA3-202020,-11|3|B3C0C7-202020,-4|0|E0F0F8-202020"},_
"5": {"起点颜色": "E0F0F8-202020", "偏移":"0|-7|E0F0F8-202020,-8|-8|DBEBF2-202020,-3|-5|0D2540-202020,-8|-1|DBEBF2-202020,-12|1|BFCDD4-202020,-17|-4|949FA4-202020,-15|-8|A5B1B7-202020,-11|-8|0D2540-202020"},_
"0": {"起点颜色": "E0F0F8-202020", "偏移":"-4|-4|E0F0F8-202020,-8|-4|DBEBF2-202020,-16|-4|98A3AA-202020,-17|0|949FA4-202020,-13|4|B7C4CB-202020,-9|4|D5E5EC-202020,-3|0|0D2540-202020,-14|0|0D2540-202020"},_
"领队": {"起点颜色": "FEFEFE-101010", "偏移":"-10|0|FEFEFE-101010,-21|0|FEFEFE-101010,0|7|FEFEFE-101010,0|15|FEFEFE-101010,-11|15|FEFEFE-101010"},_
"秘密": {"起点颜色": "32FFFF-101010", "偏移":"-26|1|18DDFF-101010,-46|20|10BCFF-101010,-4|21|33FFFF-101010,-23|37|20E3FF-101010"},_
"小boss": {"起点颜色": "0AB3D6-101010", "偏移":"-4|15|0F9EC4-101010,3|36|21C1E3-101010"},_
"体力弹框": {"起点颜色": "82C5E2-101010", "偏移":"0|19|82C5E2-101010,-11|9|82C5E2-101010,-5|1|1F2E48-101010,-5|19|1F2E48-101010"},_
"确认弹框": {"起点颜色": "97D1E1-202020", "偏移":"-9|0|A9E5F4-202020,-22|0|A9E5F4-202020,-1|13|A9E5F4-202020,-14|13|A9E5F4-202020,-23|7|A9E5F4-202020,-23|20|A9E5F4-202020,-21|13|103853-202020"},_
"白色一星": {"起点颜色": "EEEFEC-101010", "偏移":"-5|-1|6B665F-101010,-2|-4|ABABA9-101010,3|-2|B0AFAE-101010"},_
"白色二星": {"起点颜色": "EEEFEC-101010", "偏移":"0|11|EFF0ED-101010,-5|10|747068-101010,-4|7|AAAAA9-101010"},_
"白色三星": {"起点颜色": "F2F3F1-202020", "偏移":"0|11|F3F4F1-202020,0|23|EFF0ED-202020,1|31|0A0B0E-202020"},_
"白色四星": {"起点颜色": "F2F3F1-202020", "偏移":"0|11|F3F4F1-202020,0|22|F3F4F2-202020,0|34|F0F1EE-202020,1|42|030803-202020"},_
"白色五星": {"起点颜色": "F2F3F1-202020", "偏移":"0|11|F3F4F1-202020,0|22|F3F4F2-202020,0|33|F4F5F2-202020,0|45|F0F2EF-202020"},_
"白色六星": {"起点颜色": "F2F3F1-202020", "偏移":"0|11|F3F4F1-202020,0|22|F3F4F2-202020,0|33|F4F5F2-202020,0|45|F0F2EF-202020,0|57|ECEDEA-202020,1|64|100F0E-202020"},_
"异界一星": {"起点颜色": "0CD0FD-101010", "偏移":"3|1|0FCFFC-101010,-3|4|068CCA-101010"},_
"异界二星": {"起点颜色": "0CD0FD-101010", "偏移":"0|11|0CD0FD-101010"},_
"异界三星": {"起点颜色": "0CD0FD-101010", "偏移":"0|11|0CD0FD-101010,0|22|0CD0FD-101010"},_
"异界四星": {"起点颜色": "0CD0FD-101010", "偏移":"0|11|0CD0FD-101010,0|22|0CD0FD-101010,0|33|0CD0FD-101010"},_
"异界五星": {"起点颜色": "0CD0FD-101010", "偏移":"0|11|0CD0FD-101010,0|22|0CD0FD-101010,0|33|0CD0FD-101010,0|44|0CD0FD-101010"},_
"异界六星": {"起点颜色": "0CD0FD-101010", "偏移":"0|11|0CD0FD-101010,0|22|0CD0FD-101010,0|33|0CD0FD-101010,0|44|0CD0FD-101010,0|55|0CD0FD-101010"},_
"爬塔失败": {"起点颜色": "35FFFF-101010", "偏移":"-4|9|5BFFFF-101010,-4|36|4AFFFF-101010,-20|-8|42E5D9-101010,-20|16|34E1D5-101010,-20|40|3EE5D8-101010,-45|-7|34AB87-101010,-39|5|36B798-101010,-35|25|37C1A6-101010,-42|41|2EAE8B-101010"},_
"胜利": {"起点颜色": "00B1FC-202020", "偏移":"28|3|B8F7FF-202020,54|2|34FFFF-202020,1|16|0EB8FF-202020,0|85|1EBFFF-202020,20|99|88EFFF-202020,1|110|02B5FF-202020,56|124|5FFFFF-202020,56|96|38FFFF-202020,35|84|55F4FF-202020"},_
"翻车": {"起点颜色": "370AAB-101010", "偏移":"7|-5|BA86FF-101010,21|0|ECDEFF-101010,19|10|7E3FFF-101010,8|10|2E078E-101010,6|3|8354F8-101010,14|2|4B1BDA-101010,12|11|2A0786-101010,11|4|6332ED-101010,9|5|7444F5-101010"}_
}

//"FEFEFE-101010",""
dim findPicSFTb = {_
"主属性百分比": {"起点颜色": "DDD8D3-202020", "偏移":"4|4|C5BDB4-202020,-4|4|E0DCD7-202020,0|7|E1DDD8-202020,-13|5|E6E3DF-202020,0|13|E6E3DF-202020,-12|11|E8E6E2-202020,-12|18|ECEAE7-202020"},_
"主属性速度": {"起点颜色": "EEECE9-202020", "偏移":"-11|0|FAFAF9-202020,4|11|FBFBFA-202020,3|20|D0C9C2-202020,-3|8|FFFFFF-202020,-3|17|F9F8F7-202020,-12|7|FFFFFF-202020,-12|19|FFFFFF-202020,-18|13|FFFFFF-202020"},_
"速度": {"起点颜色": "78BCD2-202020", "偏移":"0|12|78BCD2-202020,-4|0|78BCD2-202020,-9|0|7FC7DE-202020,-9|12|7CC2D9-202020,-4|12|75B7CD-202020,-15|6|7CC2D9-202020"},_
"成绩结算": {"起点颜色": "8AFEFF-202020", "偏移":"0|38|76FFFF-202020,-31|-8|4DD3FE-202020,-11|13|2BEAFD-202020,-31|16|7CDDFC-202020,-15|23|30E8FB-202020,-36|32|0690F1-202020"},_
"蓝色水晶": {"起点颜色": "EFA503-202020", "偏移":"-9|0|CF780B-202020,-2|6|F6B953-202020,-11|6|974300-202020,6|6|E9D858-202020,3|13|AC7B11-202020"},_
"黄色狗粮六星": {"起点颜色": "0CD0FD-202020", "偏移":"0|15|0CD0FD-202020,0|30|0CD0FD-202020,0|46|0CD0FD-202020,0|61|0CD0FD-202020,0|78|0CD0FD-202020,3|91|01161F-202020"},_
"黄色狗粮五星": {"起点颜色": "0CD0FD-202020", "偏移":"0|16|0CD0FD-202020,0|31|0CD0FD-202020,0|46|0CD0FD-202020,0|63|0CD0FD-202020,3|77|011F2B-202020"},_
"黄色狗粮四星": {"起点颜色": "0CD0FD-202020", "偏移":"0|16|0CD0FD-202020,1|31|0CD0FD-202020,1|48|0CD0FD-202020,3|61|00080C-202020"},_
"黄色狗粮三星": {"起点颜色": "0CD0FD-202020", "偏移":"0|16|0CD0FD-202020,0|32|0CD0FD-202020,2|39|22CDF8-202020,3|47|070500-202020"},_
"黄色狗粮二星": {"起点颜色": "0CD0FD-202020", "偏移":"0|17|0CD0FD-202020,2|23|15CAF7-202020,4|31|000305-202020"},_
"黄色狗粮一星": {"起点颜色": "0DD0FD-202020", "偏移":"4|3|20D4FD-202020,-6|7|0BC7F7-202020"},_
"红色狗粮六星": {"起点颜色": "FF39FF-202020", "偏移":"0|16|FF3CFF-202020,0|31|FF3BFF-202020,0|46|FF39FF-202020,0|62|FF3DFF-202020,0|77|FF3BFF-202020,2|92|020607-202020"},_
"红色狗粮五星": {"起点颜色": "FF3DFF-202020", "偏移":"0|16|FF3FFF-202020,0|31|FF3EFF-202020,0|47|FF40FF-202020,0|63|FF40FF-202020,4|77|000200-202020"},_
"红色狗粮四星": {"起点颜色": "FF39FF-202020", "偏移":"0|16|FF3CFF-202020,0|31|FF3BFF-202020,0|47|FF3DFF-202020,2|61|01080B-202020"},_
"红色狗粮三星": {"起点颜色": "FF39FF-202020", "偏移":"0|15|FF3BFF-202020,0|31|FF3BFF-202020,3|46|04141E-202020"},_
"红色狗粮二星": {"起点颜色": "FF3BFF-202020", "偏移":"0|16|FF3DFF-202020,-5|20|A932DF-202020,2|30|060706-202020"},_
"红色狗粮一星": {"起点颜色": "FF3CFF-202020", "偏移":"2|8|C370EA-202020,3|15|010304-202020"},_
"白色狗粮二星": {"起点颜色": "F2F3F0-202020", "偏移":"2|15|F4F5F3-202020,5|18|F4F5F3-202020,-5|22|BCB7AE-202020"},_
"白色狗粮一星": {"起点颜色": "F8F9F7-202020", "偏移":"4|6|F3F4F2-202020,-8|9|BFBBB2-202020"},_
"黄色狗粮六星下": {"起点颜色": "0CD0FD-202020", "偏移":"0|12|0CD0FD-202020,0|24|0CD0FD-202020,0|36|0CD0FD-202020,0|48|0CD0FD-202020,0|62|0CD0FD-202020,3|75|011117-202020"},_
"黄色狗粮五星下": {"起点颜色": "0CD0FD-202020", "偏移":"0|12|0CD0FD-202020,0|24|0CD0FD-202020,0|36|0CD0FD-202020,0|50|0CD0FD-202020,3|63|00090C-202020"},_
"黄色狗粮四星下": {"起点颜色": "0CD0FD-202020", "偏移":"0|13|0CD0FD-202020,0|25|0CD0FD-202020,0|39|0CD0FD-202020,2|45|3AD7FC-202020,2|51|070B0C-202020"},_
"黄色狗粮三星下": {"起点颜色": "0CD0FD-202020", "偏移":"0|12|0CD0FD-202020,0|25|0CD0FD-202020,2|32|3BD8FC-202020,2|38|090804-202020"},_
"黄色狗粮二星下": {"起点颜色": "0CD0FD-202020", "偏移":"0|14|0CD0FD-202020,-6|11|15B6EA-202020,-4|18|0BC8F8-202020,1|20|0ABEF0-202020,2|27|090400-202020"},_
"黄色狗粮一星下": {"起点颜色": "0CD0FD-202020", "偏移":"7|1|38D4F9-202020,2|7|34D5FB-202020,-5|4|0BC4F5-202020,-5|-3|26D3FB-202020,3|13|010101-202020"},_
"红色狗粮六星下": {"起点颜色": "FF4CFF-202020", "偏移":"0|13|FF3BFF-202020,0|25|FF3BFF-202020,0|37|FF3AFF-202020,0|49|FF39FF-202020,0|61|FF3CFF-202020,3|75|020304-202020"},_
"红色狗粮五星下": {"起点颜色": "FF3BFF-202020", "偏移":"0|12|FF3AFF-202020,0|24|FF39FF-202020,0|36|FF3DFF-202020,0|49|FF3EFF-202020,3|62|01080C-202020"},_
"红色狗粮四星下": {"起点颜色": "FF3BFF-202020", "偏移":"0|12|FF3AFF-202020,0|24|FF39FF-202020,0|37|FF3EFF-202020,3|50|000000-202020"},_
"红色狗粮三星下": {"起点颜色": "FF3FFF-202020", "偏移":"0|12|FF43FF-202020,0|25|FF3DFF-202020,2|38|000104-202020"},_
"红色狗粮二星下": {"起点颜色": "FF3AFF-202020", "偏移":"0|5|0C0413-202020,0|13|FF3EFF-202020,2|19|BA65E6-202020,3|26|000203-202020"},_
"红色狗粮一星下": {"起点颜色": "FF3EFF-202020", "偏移":"2|-5|F99CFD-202020,-4|-2|AD38E1-202020,-4|3|AC34E1-202020,2|6|BA65E6-202020,6|1|F264FA-202020,3|13|010101-202020"},_
"白色狗粮四星下": {"起点颜色": "F2F3F1-202020", "偏移":"0|12|F3F4F1-202020,0|24|F3F4F1-202020,0|39|EBEBE9-202020,2|45|DFDEDA-202020,2|51|07080D-202020"},_
"白色狗粮三星下": {"起点颜色": "F3F4F1-202020", "偏移":"0|14|EEEFEC-202020,-4|18|C3BEB6-202020,2|21|E0DFDA-202020,2|27|090600-202020"},_
"白色狗粮二星下": {"起点颜色": "F1F2F0-202020", "偏移":"0|5|121212-202020,0|13|EFF0ED-202020,-3|17|CBC8C1-202020,1|20|B4B0A9-202020,2|26|060205-202020"},_
"白色狗粮一星下": {"起点颜色": "EEEEEC-202020", "偏移":"2|-6|F6F4F2-202020,-6|-4|E7E6E3-202020,-6|5|9F988D-202020,2|7|DEDDD8-202020,6|1|F2F2F0-202020,3|13|020101-202020"},_
"1": {"起点颜色": "DBEBF4-202020", "偏移":"0|4|E0F0F8-202020,-6|4|DEEEF6-202020,-9|4|CDDCE3-202020,-14|4|A3AFB4-202020"},_
"2": {"起点颜色": "E0F0F8-202020", "偏移":"3|4|E0F0F8-202020,-1|9|E0F0F8-202020,0|5|0D2540-202020,-7|6|CFDEE5-202020,-13|1|9DA8AE-202020,-14|9|949FA4-202020,-11|7|0D2540-202020"},_
"3": {"起点颜色": "E0F0F8-202020", "偏移":"2|5|E0F0F8-202020,-2|9|E0F0F8-202020,-6|4|DBEBF2-202020,-2|3|0E2641-202020,-11|6|0D2540-202020,-11|9|B7C4CB-202020,-15|5|949FA4-202020,-12|0|AEBBC1-202020"},_
"4": {"起点颜色": "E0F0F8-202020", "偏移":"-3|-4|DEEEF7-202020,-7|-6|D5E4EC-202020,-11|-8|B8C5CB-202020,-11|0|B8C5CB-202020,-15|0|939EA3-202020,-11|3|B3C0C7-202020,-4|0|E0F0F8-202020"},_
"5": {"起点颜色": "E0F0F8-202020", "偏移":"0|-7|E0F0F8-202020,-8|-8|DBEBF2-202020,-3|-5|0D2540-202020,-8|-1|DBEBF2-202020,-12|1|BFCDD4-202020,-17|-4|949FA4-202020,-15|-8|A5B1B7-202020,-11|-8|0D2540-202020"},_
"0": {"起点颜色": "E0F0F8-202020", "偏移":"-4|-4|E0F0F8-202020,-8|-4|DBEBF2-202020,-16|-4|98A3AA-202020,-17|0|949FA4-202020,-13|4|B7C4CB-202020,-9|4|D5E5EC-202020,-3|0|0D2540-202020,-14|0|0D2540-202020"},_
"领队": {"起点颜色": "FEFEFE-202020", "偏移":"-6|0|FEFEFE-202020,-15|0|FEFEFE-202020,-15|5|FEFEFE-202020,-15|9|FEFEFE-202020,-9|15|FEFEFE-202020,-7|24|FEFEFE-202020"},_
"秘密": {"起点颜色": "2DFAFF-202020", "偏移":"-14|-13|5BEAFF-202020,-24|-3|2BD5FF-202020,-15|13|59E9FF-202020,-40|-11|01B5FF-202020,-14|35|6CEDFF-202020,0|51|2DFCFF-202020,-15|50|63DFF2-202020,-30|47|0CC6FF-202020"},_
"小boss": {"起点颜色": "0AB3D6-101010", "偏移":"-4|15|0F9EC4-101010,3|36|21C1E3-101010"},_
"体力弹框": {"起点颜色": "82C5E2-202020", "偏移":"0|23|82C5E2-202020,-15|0|82C4E1-202020,-20|10|82C5E2-202020,-14|22|80C3E0-202020,-8|10|82C5E2-202020"},_
"确认弹框": {"起点颜色": "A9E5F4-202020", "偏移":"-8|0|A9E5F4-202020,-20|0|A9E5F4-202020,-19|4|A9E5F4-202020,2|13|A9E5F4-202020,-12|13|A9E5F4-202020,-21|7|A9E5F4-202020,-21|19|A9E5F4-202020,-19|13|103853-202020,-25|13|4387BE-202020"},_
"白色一星": {"起点颜色": "F2F3F1-202020", "偏移":"1|6|DAD8D2-202020,1|9|161513-202020"},_
"白色二星": {"起点颜色": "F2F3F1-202020", "偏移":"0|11|F2F3F1-202020,1|16|EAE9E6-202020,1|20|1D1C1A-202020"},_
"白色三星": {"起点颜色": "F2F3F1-202020", "偏移":"0|11|F2F3F1-202020,0|23|F0F0EE-202020,1|27|EBEAE7-202020,1|32|07090D-202020"},_
"白色四星": {"起点颜色": "F2F3F1-202020", "偏移":"0|11|F2F3F1-202020,0|23|F0F0EE-202020,0|34|F0F1EE-202020"},_
"白色五星": {"起点颜色": "F2F3F1-202020", "偏移":"0|11|F2F3F1-202020,0|22|F3F4F1-202020,0|34|F0F1EE-202020,0|45|F0F1EF-202020,0|53|070401-202020"},_
"白色六星": {"起点颜色": "F2F3F1-202020", "偏移":"0|11|F2F3F1-202020,0|22|F3F4F1-202020,0|34|F0F1EE-202020,0|44|F4F5F2-202020,0|56|F1F2F0-202020,0|64|030105-202020"},_
"异界一星": {"起点颜色": "0CD0FD-101010", "偏移":"3|1|0FCFFC-101010,-3|4|068CCA-101010"},_
"异界二星": {"起点颜色": "0CD0FD-101010", "偏移":"0|11|0CD0FD-101010"},_
"异界三星": {"起点颜色": "0CD0FD-101010", "偏移":"0|11|0CD0FD-101010,0|22|0CD0FD-101010"},_
"异界四星": {"起点颜色": "0CD0FD-101010", "偏移":"0|11|0CD0FD-101010,0|22|0CD0FD-101010,0|33|0CD0FD-101010"},_
"异界五星": {"起点颜色": "0CD0FD-101010", "偏移":"0|11|0CD0FD-101010,0|22|0CD0FD-101010,0|33|0CD0FD-101010,0|44|0CD0FD-101010"},_
"异界六星": {"起点颜色": "0CD0FD-101010", "偏移":"0|11|0CD0FD-101010,0|22|0CD0FD-101010,0|33|0CD0FD-101010,0|44|0CD0FD-101010,0|55|0CD0FD-101010"},_
"爬塔失败": {"起点颜色": "34FFFF-202020", "偏移":"-38|-7|33B292-202020,-17|31|34E7DC-202020,2|59|34FFFF-202020,3|87|32FFFF-202020,-18|57|34E5D9-202020,-38|53|33B292-202020,-41|81|32AB89-202020,-19|82|34E2D5-202020"},_
"胜利": {"起点颜色": "34FFFF-202020", "偏移":"-38|10|09BCFF-202020,3|34|34FFFF-202020,4|62|32FFFF-202020,-37|55|0ABEFF-202020,-3|122|33FEFF-202020,-2|92|34FFFF-202020,-31|88|12CAFF-202020,-34|116|0DC3FF-202020"},_
"翻车": {"起点颜色": "4615D8-202020", "偏移":"-1|-6|B883FF-202020,6|-1|EADAFF-202020,4|9|7F3FFF-202020,-8|9|2C078A-202020,-6|4|7444F4-202020"},_
"强化三星黄色": {"起点颜色": "0CD0FD-202020", "偏移":"0|13|0CD0FD-202020,0|28|0CD0FD-202020,2|34|3CD9FD-202020,2|40|010202-202020"},_
"强化三星红色": {"起点颜色": "FE42FF-202020", "偏移":"0|13|FE42FF-202020,0|27|FE40FF-202020,3|34|C372EA-202020,3|40|01080C-202020"},_
"强化二星黄色": {"起点颜色": "0CD0FD-202020", "偏移":"0|15|0CD0FD-202020,3|22|32D9FD-202020,3|27|00090C-202020"},_
"强化二星红色": {"起点颜色": "FF41FF-202020", "偏移":"0|14|FF3FFF-202020,2|21|A441D7-202020,3|27|03121B-202020"},_
"强化二星白色": {"起点颜色": "F1F2F0-202020", "偏移":"0|14|EEEFED-202020,2|21|E2E1DD-202020,2|27|010102-202020"}_
}
//"0CD0FD-202020",""
Dim findColorTb = {_
"官服传说" : Array("062175"),_
"官服英雄" : Array("431160"),_
"官服稀有" : Array("4C4209"),_
"官服魔法" : Array("033500"),_
"官服普通" : Array("464551"),_
"官服沙漏" : Array("1E5992-202020","42A0D8-202020","73BEE8-202020","475F87-202020","2474A8-202020","03AFFD-202020","9EB0C4-202020","B2ABBC-202020","009EFD-202020","CFEBFB-202020")_
}

Dim findColorSFTb = {_
"私服传说" : Array("4599E0-202020","4294D9-202020"),_
"私服英雄" : Array("F988EE-202020","BC60C2-202020"),_
"私服稀有" : Array("EDFF52-202020","DADC45-202020"),_
"私服魔法" : Array("61D304-202020","50BA0C-202020"),_
"私服普通" : Array("F8E7F1-202020","D4C8D3-202020"),_
"私服沙漏" : Array("1E5992-202020","42A0D8-202020","73BEE8-202020","475F87-202020","2474A8-202020","03AFFD-202020","9EB0C4-202020","B2ABBC-202020","009EFD-202020","CFEBFB-202020")_
}


//Dim 颜色数据Tab()'里面只放多点找色的颜色数据的值


//采集魔灵图片
checkUpdate

//judgeQuestion
//判断符文
//TracePrint 比例判断魔灵星级(240,700,280,900, false)
//比例判断魔灵星级 240, 700, 280, 900, false
//judgeMoLingStar(240,700,280,900, false)
//比例判断脚本模式

//地下城循环
//爬塔循环
//竞技场循环
//异界地下循环
//狗粮循环
//突袭模式
//
//找图



Function 比例判断脚本模式
    TracePrint "开始判断脚本模式"
    Dim UIType = ReadUIConfig("模式",0)
 	
    If UIType = 0 Then 
        //地下城模式
        type = 10
        TracePrint "地下城模式"
        ShowMessage "地下城模式"
        地下城循环	
    End If
	
    
    If UIType = 1 Then 
        type = 20
        TracePrint "异界地下城"
        ShowMessage "异界地下城"
        Delay 2000
        异界地下循环
    End If
        
    	
    If UIType = 2 Then 
    
        type = 1
        TracePrint "爬塔模式"
        ShowMessage "爬塔模式"
        Delay 2000
        爬塔循环
    End If
        
    	
    If UIType = 3 Then 
    
        type = 3
        TracePrint "异界突袭"
        ShowMessage "异界突袭"
        Delay 2000
        突袭模式
    		
    End If
    
    
    If UIType = 4 Then 
    
        type = 4
        TracePrint "狗粮模式"
        ShowMessage "狗粮模式"
        Delay 2000
        狗粮循环
    End If
    	
    If UIType = 5 Then 
    
        type = 5
        TracePrint "普通竞技场"
        ShowMessage "普通竞技场"
        Delay 2000
        竞技场循环
    		
    End If
    
    //	
    If UIType = 6 Then 
    
        type = 6
        TracePrint "次元模式"
        ShowMessage "次元模式"
        Delay 2000
        地下城循环
    End If

    //    endReason = "识别模式失败,请在战斗准备界面开启脚本,如无误,则脚本不支持,目前还在优化中~"
    //    stopTheScript
	
End Function


Function customFindPic(x1, y1, x2, y2, picName)

    Dim isSF = ReadUIConfig("私服",false)
    If isSF = False Then 
        If ReadUIConfig("秘密地下", false) = True and type = 0 and picName = "胜利" Then 
            FindMultiColor 491,432,711,897,findPicTb["秘密"]["起点颜色"],findPicTb["秘密"]["偏移"],2,1,intP,intQ    	
        Else 
            FindMultiColor x1, y1, x2, y2,findPicTb[picName]["起点颜色"],findPicTb[picName]["偏移"],2,1,intP,intQ
        End If
    Else 
        If ReadUIConfig("秘密地下", false) = True and type = 0 and picName = "胜利" Then 
            FindMultiColor 491,432,711,897,findPicSFTb["秘密"]["起点颜色"],findPicSFTb["秘密"]["偏移"],2,1,intP,intQ    	
        Else 
            FindMultiColor x1, y1, x2, y2,findPicSFTb[picName]["起点颜色"],findPicSFTb[picName]["偏移"],2,1,intP,intQ
        End If
    End If

    If intP > -1 And intQ > -1 Then
        //找到特征点
        customFindPic = True
        //        TracePrint intP,intQ
    Else 
        //没有找到特征点
        customFindPic = False
    End If
End Function

//图片名字需要带后缀
Function 找图(x1, y1, x2, y2, pic)
	
    Dim isSF = ReadUIConfig("私服",false)
    Dim fullName
    If isSF = False Then 
        fullName = "官服_" & pic
    Else 
        fullName = "私服_" & pic
    End If
    Dim ret
    ret = zm.FindPic(x1, y1, x2, y2, fullName, 0.9, 返回数组)
    If ret Then
        TracePrint  "找到了图片..." & fullName
        i = 0      
        找图 = 1
    Else
        找图 = 0	
    End If

End Function


Function 找色(x1, y1, x2, y2, desc)



    If zm.FindMultiColor (desc, x1, y1, x2, y2) Then 
        'XYA这里的值为:坐标X,坐标Y,0
        TracePrint "找到坐标为:" & 返回数组["x"] & "," & 返回数组["y"]
        x = 返回数组["x"]
        y = 返回数组["y"]
        找色 = 1
    Else
        '这里的值为 -1,-1,-1
        TracePrint "没有找到"
        找色 = 0
    
    End If

    Delay 100

End Function

'固定功能模块
'比例换算功能作用：把传入的数组信息，每一个元素值进行判断，凡是数字内容均乘以对应比例进行换算后重新赋值返回
Function 比例换算(数组)
    Dim arr(),arr_bl(),i,n
    arr=数组
    arr_bl=Array(win_w,win_h)
    i=0
    For Each n In arr
        If IsNumeric(n)=True Then
            arr(i)=n*arr_bl(i Mod 2)'这里计算根据比例不同，传入对应换算值 x坐标*win_x比例，y坐标*win_y比例
        ElseIf InStr(1,n,"|")>0 Then
            Dim arr1(),str,arr2()
            arr1=Split(arr(i),",")
            str=""
            For Each n In arr1
                arr2=Split(n,"|")
                str=str & arr2(0)*win_w & "|" & arr2(1)*win_h & "|" & arr2(2) & ","
            Next
            arr(i)=Left(str,Len(str)-1)
            Exit For
        End If
        i=i+1
    Next
    比例换算=arr
End Function


Function 比例动态找色(arr)
	
    //--------------------查找变化动态图--------------------//
    Dim ret 
    ret = zm.CmpColorEx(arr(0), arr(1), arr(2), 0.7,3000)
    If ret Then
        TracePrint "找到:" & arr(3)
        比例动态找色 = 1
    Else
        比例动态找色 = 0
    End If

End Function

Function 比例找色(arr)
	
    FindMultiColor arr(0), arr(1), arr(2), arr(3), CStr(arr(4)), CStr(arr(5)), 4, 0.9, x, y

    If x > -1 Then 
        TracePrint "找到:" & arr(6)
        比例找色 = 1
        
    Else 
        比例找色 = 0
    	
    End If

End Function

Function 比例比色(arr)
	
    If CmpColorEx(arr(0),0.9) = 1 Then
        比例比色 = 1
    Else
        比例比色 = 0
    End If


End Function

Function 找字(x1, y1, x2, y2, txt,color)

    FindStr(x1, y1, x2, y2,txt,color,0.8,x,y)
    If x > -1 And y > -1 Then
        TracePrint "找到:" & txt
        找字 = 1    
    Else 
        //    	TracePrint "没找到:" & txt
        找字 = 0        
    End If

End Function

Function 随机数(M,X)
    Dim MyValue
    MyValue = Int(((M-X+1) * Rnd()) + X)   
    随机数= MyValue
End Function

Function 比例触摸_随机点(x,y,x1,y1)
    dim newArr = 比例换算(Array(x,y,x1,y1))
    Dim x范围 = 随机数(newArr(0),newArr(2))
    Dim y范围 = 随机数(newArr(1),newArr(3))
    触摸_点 x范围, y范围    
End Function

Function 触摸_随机点(x,y,x1,y1)    
    Dim x范围 = 随机数(x1,x)
    Dim y范围 = 随机数(y1,y)
    触摸_点 x范围, y范围    
End Function

Function 触摸_点(x, y)
    Dim delayTime  
    delayTime = int(Rnd() * 500 + 1000)//取1000-1500毫秒随机数
    Delay delayTime
    TracePrint "点击...",x,y
    Tap x, y
    delayTime = int(Rnd() * 500 + 1000)//取1000-1500毫秒随机数
    Delay delayTime
End Function

//判断范围内是否存在某些颜色
Function CustomFindColors(minX, minY, maxX, maxY, colorName)

    Dim result = True     
    Dim i
    Dim isSF = ReadUIConfig("私服",false)
    Dim intX,intY
    If isSF = True Then 
    	
        For Each c In findColorSFTb[colorName]

        
            //            TracePrint v(i)
            FindColor minX, minY, maxX, maxY, c, 0, 1, intX, intY
	
            If intX < 0 and intY < 0 Then 
                //有一个没找到就终止循环
                result = False 
                Exit For
            Else 
                result = True
            End If

              
        Next
    Else 
    	
        For Each c In findColorTb[colorName]

            //            TracePrint v(i)
            FindColor minX, minY, maxX, maxY, c, 0, 1, intX, intY
	
            If intX < 0 and intY < 0 Then 
                //有一个没找到就终止循环
                result = False 
                Exit For
            Else 
                result = True
            End If

              
        Next
    End If
    

    CustomFindColors = result 
	
End Function

Function checkNetwork
    Dim isSF = ReadUIConfig("私服",false)
    Dim intS=-1,intT=-1,intS2=-1,intT2=-1
    If isSF = False Then 
        FindPic 414,767,510,859,"Attachment:官服网络失败.bmp","101010",0,1,intS,intT
        FindPic 437,625,491,686,"Attachment:官服网络失败.bmp","101010",0,1,intS2,intT2
    Else 
        FindPic 414,587,518,940,"Attachment:私服网络失败.bmp","202020",0,0.9,intS,intT
    End If
        
    If (intS > -1 And intT > -1) or (intS2 > -1 And intT2 > -1) Then
        TracePrint "检测到网络卡顿"
        RandomClickInRectNoCheck 269,460,305-269,591-460 ,1   	
    End If
End Function


Function 采集魔灵图片
    Dim i = 1
	
    For i = 1 To 113
        Dim snapPath = GetSdcardDir() & "/$MuMu共享文件夹/snap" & i & ".png"
        TracePrint snapPath
        SnapShot snapPath, 609,158,666,215
        Delay 200
        比例触摸_随机点 664,1132,701,1171	//点击X
        Delay 200
        比例触摸_随机点 359,1072,396,1095  	//点击下一个
        Delay 200
        比例触摸_随机点 551,297,580,364	//点击魔灵信息
        Delay 700
    Next
End Function

Function 异界地下循环

    Do

        If 比例找色(体力不足) = 1 or 比例找色(邮箱体力不足) = 1 Then 
            judgeTiLi
            Goto loading
        End If
        
        
        
        If 比例找色(开始战斗) = 1 or 比例找色(次元开始战斗) = 1 Then 
            触摸_随机点 x, y, x + 10, y + 10	//开始战斗
            Goto loading
        End If
		
        If 比例比色(非自动) = 1 Then 
            比例触摸_随机点 18,208,75,266	//开启自动
            Goto loading
        End If
        
        
        If 比例找色(材料) = 1 Then 

            判断符文
            Goto loading
        End If

        If 比例找色(再来一次) = 1 Then 
            judgeTimes
            比例触摸_随机点 308,269,346,538	//点再来一次
            
            If 比例找色(体力不足) = 1 or 比例找色(邮箱体力不足) = 1 Then 
                TracePrint "体力不足"
            Else 
                TracePrint "没找到体力不足,胜利次数+1"
                success = success + 1
            End If
            Goto loading
        End If
        
        //买体后需要点进对应地图
        If 比例找色(进行战斗) = 1 Then 
            比例触摸_随机点 105,863,156,1027
            Goto loading
        End If
        
        If customFindPic(554,490,668,783, "成绩结算") = True Then 
            Delay 5000
            TracePrint "结算"
            比例触摸_随机点 216, 332, 488, 1165
            
            If 比例找色(再来一次) = 1 Then 
                Goto loading
            End If
            
            比例触摸_随机点 216, 332, 488, 1165
            //点出宝箱

            Delay 2000
            比例触摸_随机点 278,771,347,792		//点出掉落物品
            Goto loading
        End If
        
        If 比例找色(确认) = 1 Then 
            比例触摸_随机点 105,569,145,709	//点击确定
            Goto loading
        End If
        
        比例判断网络波动
		
        Rem loading
        Delay 500

    Loop 
	
End Function


//地下城模式
Function 地下城循环

    TracePrint "地下城循环"
    Dim smallBoss = False
    Dim isFailed = False
    Do
        
        If 比例找色(体力不足) = 1 or 比例找色(邮箱体力不足) = 1 Then 
            judgeTiLi
            Goto loading
        End If

        //巨人龙死亡支持重启
        If 比例找色(列表巨人) = 1 Then 
            //点击对应模式
            触摸_随机点 x, y, x + 10, y + 10
                
            Rem 巨人到底检测
            If 比例找色(巨人十层) = 1 Then 
                //点击选择10层
                Delay 1000
                比例触摸_随机点 71,1018,131,1102
            Else 
                //滑到最底层
                zm.Swipe 96, 866, 96, 866, 1000
                Goto 巨人到底检测
            End If
        End If

        If 比例找色(列表龙) = 1 Then 
            //点击对应模式
            触摸_随机点 x, y, x + 10, y + 10
                
            Rem 龙到底检测
            If 比例找色(龙十层) = 1 Then 
                //点击选择10层
                Delay 1000
                比例触摸_随机点 71,1018,131,1102
            Else 
                //滑到最底层
                zm.Swipe 96, 866, 96, 866, 1000
                Goto 龙到底检测
            End If

        End If

        If 比例找色(列表死亡) = 1 Then 
            //点击对应模式
            触摸_随机点 x, y, x + 10, y + 10
                
            Rem 死亡到底检测
            If 比例找色(死亡十层) = 1 Then 
                //点击选择10层
                Delay 1000
                比例触摸_随机点 71,1018,131,1102
            Else 
                //滑到最底层
                zm.Swipe 96, 866, 96, 866, 1000
                Goto 死亡到底检测
            End If
        End If

 
        
 		
        If 比例找色(开始战斗) = 1 or 比例找色(次元开始战斗) = 1 Then 
            触摸_随机点 x, y, x + 10, y + 10	//开始战斗
            Goto loading
        End If
		
        If 比例比色(非自动) = 1 Then 
            比例触摸_随机点 18,208,75,266	//开启自动
            Goto loading
        End If
        
        
        If 比例找色(材料) = 1 Then 

            判断符文
            Goto loading
        End If
        
        If 比例找色(再来一次) = 1 or 比例找色(战斗准备) = 1 Then 
            judgeTimes
            比例触摸_随机点 308,269,346,538	//点再来一次
            smallBoss = false
            
            If 比例找色(体力不足) = 1 or 比例找色(邮箱体力不足) = 1 Then 
                TracePrint "体力不足"
            Else 
                If isFailed = False Then 
                    TracePrint "没找到体力不足,胜利次数+1"
                    success = success + 1
                End If
                isFailed = False

                ShowMessage ("泰迪脚本运行结果：\n(①群：838134503，②群：654740867)\n" &_ 
                "成功次数：" & success & "	失败次数：" & failure & "	买体次数：" &_
     buyTimes & "\n答题正确：" & answerTrue &_
      "	答题错误：" & answerFalse &_
        "\n六星符文：" & "紫六：" & Z6 & "	蓝六：" & L6 & "	橙六：" & C6  &_
        "\n五星符文：" & "紫五：" & Z5 & "	橙五：" & C5 &_
        "\n精炼石："  & "蓝：" & SL & "	紫：" & SZ & "	橙：" & SC &_
        "\n神器："  & "蓝：" & 蓝色神器数 & "	紫：" & 紫色神器数 & "	橙：" & 橙色神器数),20000,0,0
            End If
            Goto loading
        End If


        If 比例找色(胜利) = 1 or 找图(563,664,660,867, "秘密地下.bmp") = 1 Then 
            比例触摸_随机点 216,332,488,1165
            比例触摸_随机点 216, 332, 488, 1165
            //点出宝箱
            Goto loading
        End If
        
        If 比例找色(失败) = 1 Then 
            比例触摸_随机点 295,231,364,583	//翻车点击否后会出现,随机点再来一次
            failure = failure + 1
            isFailed = True
            Goto loading
        End If
        
        If 比例找色(翻车) = 1 Then 
            比例触摸_随机点 227,735,272,909	//翻车点击否	
            //            failure = failure + 1
            Goto loading
        End If
        
        比例判断网络波动
		
        Rem loading
        Delay 700
        //        TracePrint "loading或战斗中,等待2s"
    Loop 
	
End Function

Function 比例判断网络波动
    If 比例找色(网络波动) = 1 or 比例找色(网络波动2) = 1 Then 
        
        //点击是    
        比例触摸_随机点 262, 478, 311, 577
        比例判断网络波动 = 1
    ElseIf 比例找色(网络波动) = 1 Then
        //点击确定
        比例触摸_随机点 265,589,306,693
        比例判断网络波动 = 1
        
    Else 
        
        //判断一些所有模式通用的判断
        
        //判断是否有魔灵满级
        If type >= 10 Then 
            If 比例找色(广告叉) = 1 Then 
                触摸_随机点 x, y, x + 10, y + 10
            End If
        End If
        
        比例判断网络波动 = 0
    End If
End Function

Function 爬塔循环
    
    TracePrint "爬塔模式"
    Dim smallBoss = False
    Do

        If 比例找色(体力不足) = 1 or 比例找色(邮箱体力不足) = 1 Then 
            judgeTiLi
            Goto loading
        End If
        
        If 比例找色(开始战斗) = 1 Then 
            触摸_随机点 x, y, x + 10, y + 10	//开始战斗
            If 比例找色(体力不足) = 1 or 比例找色(邮箱体力不足) = 1 Then 
                TracePrint "体力不足"
            Else 
                TracePrint "没找到体力不足,胜利次数+1"
                success = success + 1
            End If
            Goto loading
        End If
		
        If 比例比色(非自动) = 1 Then 
            比例触摸_随机点 18,208,75,266	//开启自动
            Goto loading
        End If
        
        If 比例找色(小boss) = 1 and smallBoss = false Then 
            TracePrint "集火boss"
            Delay 800
            比例触摸_随机点 447,593,509,677	//集火boss 447,593,509,677
            smallBoss = True
            Goto loading
        End If
              
        If 比例找色(材料) = 1 Then 

            判断符文
            Goto loading
        End If

        If 比例找色(下一层) = 1 Then 
            judgeTimes
            触摸_随机点 308,269,346,538	//点再来一次   
            smallBoss = False
            Goto loading
        End If

        If 比例找色(胜利) = 1 Then 
            比例触摸_随机点 216,332,488,1165
            比例触摸_随机点 216, 332, 488, 1165
            //点出宝箱
            Goto loading
        End If
        
        If 比例找色(失败) = 1 Then 
            比例触摸_随机点 295,231,364,583	//翻车点击否后会出现,随机点再来一次
            failure = failure + 1
            Goto loading
        End If
        
        比例判断网络波动 
		
        Rem loading
        Delay 1000

    Loop 
	
End Function

Function 竞技场循环
    Dim isFailed = False
    Do

        If 比例找色(体力不足) = 1 or 比例找色(邮箱体力不足) = 1 Then 
            TracePrint "竞技场出场券用完"
            endReason = "竞技场出场券用完"
            stopTheScript
        End If
        
        If 比例找色(竞技场开始战斗) = 1 Then 
            //需要判断是否满防和满状态
            dim starTop = judgeMoLingStar(481,894,590,1022,true)
            dim starLeft = judgeMoLingStar(390,757,529,886,true)
            dim starRight = judgeMoLingStar(394,1020,525,1155,true)
            dim starBottom = judgeMoLingStar(324,884,455,1018,true)
            If starTop = 6 and starLeft = 6 and starRight = 6 and starBottom = 6 Then 
                TracePrint "满防御，跳过"
                触摸_随机点 670,1222,712,1264	//点击X
                isFailed = True
            Else 
                触摸_随机点 x, y, x + 10, y + 10	//开始战斗
                success = success + 1
            End If
            
            Goto loading
        End If
        
        If 比例找色(符文不全) = 1 Then 
            触摸_随机点 259,487,308,568	//点击是
            Goto loading
        End If
        
        
        If 比例找色(翅膀) = 1 or 比例找色(翅膀反击) = 1 Then 
            If isFailed = True Then 
                //失败了，点击刷新
                触摸_随机点 532,152,566,255	//点击对战
                触摸_随机点 529, 905, 558, 1068	//刷新列表
                触摸_随机点 308,570,352,707	//点击刷新
                If 比例找色(竞技场刷新等待) = 1 Then 
                    ShowMessage "等待120秒"
                    Delay 120000
                    触摸_随机点 554,919,588,956	//点击关闭
                    Goto loading
                End If
                isFailed = False
            Else
                触摸_随机点 x, y, x+20, y+20	//开始战斗
            End If
            
            Goto loading
        End If
        
        If 比例找色(竞技场列表) = 1 Then 
            TracePrint "需要滑动"
            //取两点颜色 
    
            Dim p1,p2,n1,n2
            p1 = GetPixelColor(360,385)
            p2 = GetPixelColor(360,405)

            Swipe 360, 385, 400, 385,2

            Delay 2000
            n1 = GetPixelColor(360,385)
            n2 = GetPixelColor(360,405)
            If p1 = n1 and p2 = n2 Then 
                //当前页已清理完，点击对战
                触摸_随机点 532,152,566,255	//点击对战
            End If
            
            Goto loading
        End If
		
		
		
        If 比例找色(对话框) = 1 Then 
            
            触摸_随机点 142,386,360,1087	//NPC对话,随机点一下
            Goto loading
        End If
        
        If 比例比色(非自动) = 1 Then 
            比例触摸_随机点 18,208,75,266	//开启自动
            Goto loading
        End If
        
        

        If 比例找色(胜利) = 1 Then 
            比例触摸_随机点 216,332,488,1165
            比例触摸_随机点 216, 332, 488, 1165
            //点出宝箱
            Goto loading
        End If
        
        If 比例找色(失败) = 1 Then 
            TracePrint "竞技场失败"
            比例触摸_随机点 366, 534, 547, 835
            比例触摸_随机点 366, 534, 547, 835
            isFailed = True
        End If

        比例判断网络波动

        Rem loading
        Delay 500
        //        TracePrint "loading或战斗中,等待2s"
    Loop 
	
End Function

//狗粮循环
Function 狗粮循环
	
    Do
        
        
        If 比例找色(开始战斗) = 1 Then 
            
            If customFindPic(499,311,558,367,"领队") Then
                
                isFriend = True
            Else 
                   
                isFriend = False
            End If
            TracePrint "是否好友队长:" & CInt(isFriend)
            If isFriend = True Then 
                //好友狗粮模式
                //更换好友62,40,130,111 
                RandomClickInRectNoCheck(62,40,130-62,111-40,1)	//点击第一个好友
        	
                //判断好友是否已用完
                If customFindPic(204,484,382,801,"确认弹框") = True Then 
                    //好友用完，结束脚本
                    endReason = "好友已用完~"
                    EndScript	
        	            
                End If
            End If
        
            //不管是不是好友模式都需要判断魔灵是否满级
            judgeMoLingLevel 473,126,518,263
            //        Delay 1000
            judgeMoLingLevel 402,258,451,390
            //        Delay 1000
            judgeMoLingLevel 472,388,520,520
 
            比例触摸_随机点 178,989,242,1178	//开始战斗
            比例触摸_随机点 255, 446, 317, 607	//点击是
            isScrollEnd = False
            Goto loading
        End If
		
        If 比例比色(非自动) = 1 Then 
            比例触摸_随机点 18,208,75,266	//开启自动
            Goto loading
        End If

        If 比例找色(材料) = 1 Then 

            判断符文
            Goto loading
        End If
        
        If 比例找色(再来一次) = 1 or 比例找色(狗粮战斗准备) = 1 Then 
            judgeTimes
            比例触摸_随机点 308,269,346,538	
            If 比例找色(体力不足) = 1 or 比例找色(邮箱体力不足) = 1 Then 
                TracePrint "体力不足"
            Else 
                TracePrint "没找到体力不足,胜利次数+1"
                success = success + 1
            End If
            Goto loading
        End If


        If 比例找色(体力不足) = 1 or 比例找色(邮箱体力不足) = 1 Then 
            judgeTiLi
            Goto loading
        End If
        
        
        
        If 比例找色(胜利) = 1 Then 
            比例触摸_随机点 216,332,488,1165
            比例触摸_随机点 216, 332, 488, 1165
            //点出宝箱
            Goto loading
        End If
        
        If 比例找色(失败) = 1 Then 
            比例触摸_随机点 224,731,275,915	//翻车点击否 230,741,267,917
            比例触摸_随机点 224,731,275,915	//翻车点击否 230,741,267,917
            failure = failure + 1
            Goto loading
        End If
        
        比例判断网络波动

		
        Rem loading
        Delay 500

    Loop 
	
End Function

//突袭模式
Function 突袭模式
    type = 3 
    Dim timeLeft = 240
    Do

        If 比例比色(战斗中) = 1 Then 
            //            TracePrint "战斗中"
            Goto loading
        End If
        
        If 比例找色(等待队友) = 1 Then 
            ShowMessage "等待队友准备中"
            Goto loading
        End If
        
        If 比例找色(突袭确认) = 1 Then 
            比例触摸_随机点 268,586,307,695 	//点击确认
            Goto loading
        End If
        
        If 比例找色(无队长技) = 1 Then 
            比例触摸_随机点 262,484,312,579 	//点击是
            Goto loading
        End If
        
        
        If 比例找色(材料) = 1 Then 

            判断符文 
            judgeTimes
            比例触摸_随机点 264,481,308,580	//相同队伍挑战
            Goto loading
        End If
        

        If 比例找色(体力不足) = 1 or 比例找色(邮箱体力不足) = 1 Then 
            judgeTiLi 
            Delay 1000
            
            //            TracePrint "体力不足后,测试点击是"
            //            比例触摸_随机点 265,470,306,586	//相同队伍挑战265,470,306,586
            Goto loading
        End If
       
        If 比例找色(胜利) = 1 Then 
            Delay 4000
            比例触摸_随机点 216, 332, 488, 1165
            success = success + 1
            //点出宝箱
            Goto loading
        End If
        
        If 比例找色(需要准备) = 1  Then
            //            TracePrint "找到突袭准备完毕"
            比例触摸_随机点 48,1037,122,1231	//点击准备
            Goto loading
        End If
        
        If 比例找色(已经准备) = 1  Then
            //            TracePrint "找到突袭取消准备"
            ShowMessage "已准备,等待队长开始"
            Goto loading
        End If
        
        If 比例动态找色(突袭战斗开始) = 1 Then
            //            TracePrint "找到突袭战斗开始"
            比例触摸_随机点 48,1037,122,1231	//开始战斗
            比例触摸_随机点 259,456,311,598	//是
            Goto loading
        End If
        
        If 比例找色(失败) = 1 Then 
            Delay 3000
            比例触摸_随机点 80,1059,135,1178	//翻车随机点一次
            比例触摸_随机点 263,460,307,592	//点击再来一次
            failure = failure + 1
            Goto loading
        End If       
		

	
        比例判断网络波动
        
        Rem loading
        Delay 500
        //        TracePrint "loading或战斗中,等待2s"
    Loop 
	
End Function

Function 找开始战斗动态图
    Dim ixys() //定义数组参数返回值

    //这里是使用了3个多点数据, 要求循环查找50次, 可以根据实际情况自由调整大小
    If zm.FindMultiColor(20,1008,153,1259,"FFFFFF","-20|25|79D4FD,-60|15|49A6D5",50,ixys,"93D3E9","-42|19|48A4CF,-78|7|368EC1","7CCCE4","-42|9|49A3CE,-77|4|368EC1") Then 
        找开始战斗动态图 = True
    Else 
        找开始战斗动态图 = False
    End If

End Function


//判断掉落物品并再来一次(地下城模式)	
Function 判断符文
    TracePrint "判断掉落"
    Dim isSF = False
    isChooseALL = ReadUIConfig("ALL", false)
    dim 蓝色神器 = ReadUIConfig("蓝色神器",true)
    dim 紫色神器 = ReadUIConfig("紫色神器",true)
    //成功,此时已经点开箱子了 457,413,496,494
    TracePrint "开始判断掉落结果"

    //判断符文星级
    Dim star = judgeFuWenLevel(460,385,540,490)
    TracePrint "星级:" & star
      
    //判断符文颜色 地下城符文范围：446,776,490,888  异界范围：493,777,536,886
    Dim color = judgeFuwenColor(446,777,536,888)
    TracePrint "符文颜色:" & color
    //判断是不是精炼石
    //    Dim stone = 找图(179,450,252,617, "出售.bmp")
    Dim  stone = 比例找色(出售)
    
    TracePrint "是不是精炼石:" & stone
    Dim intX,intY

    Select Case color
    Case 0
        //判断模式
        //判断模式
        Select Case type
        Case -1,10,11,12,1,2,4,6
                
            //点击确认
            TracePrint "材料"
            If 比例找色(材料) = 1 Then 
                触摸_随机点 x,y,x+10,y+10	//掉落材料,点击X
            Else 
                TracePrint "识别异常"
            End If
            
        Case 20,21,22,23,24
            //异界地下城模式
            isTuTuL = ReadUIConfig("蓝色精炼",true)
            isTuTuZ = ReadUIConfig("紫色精炼",true)
                
            If stone = 1 Then 
                //说明是精炼石，判断颜色
                    
                //判断是不是紫色精炼石
                If isSF = True Then 
                    FindColor 439,517,489,766,"FF8CF3-202020|BA5FC1-202020",0,1,intX,intY	//私服找紫色
                Else 
                    FindColor 437,515,504,821, "D470D4-101010|FF8CF3-101010", 0, 1, intX, intY
                End If

                If intX > -1 And intY > -1 Then 
                        
                    TracePrint "紫色精炼石"
                    If isTuTuZ = True Then 
                        ShowMessage "获取紫色精炼石"
                        If isSF = True Then 
                            RandomClickInRect 233,676,281-233,819-676, 1	//私服点击获取精炼石233,676,281,819
                        Else 
                            RandomClickInRect 188,674,237-188,821-674, 1	//点击获取新异界精炼石188,674,237,821
                        End If
                        SZ = SZ + 1
                    Else 
                        ShowMessage "出售紫色精炼石"
                        If isSF = True Then 
                            RandomClickInRect 231,459,285-231,606-459, 1	//私服点击出售精炼石231,459,285,606
                            RandomClickInRect 264,459,308-264,596-459, 1	//点击是264,459,308,596 
                        Else 
                            RandomClickInRect 189,459,237-189,605-459, 1	//点击异界新出售精炼石189,459,237,605
                            RandomClickInRect 264,459,308-264,596-459, 1	//点击是264,459,308,596 
                        End If
                    End If
                Else 
                        
                    //判断是不是蓝色精炼石
                    If isSF = True Then 
                        FindColor 438, 513, 490, 805, "EDFF52-202020|D0CA3F-202020", 0, 1, intX, intY
                    Else 
                        FindColor 438, 518, 518, 803, "D6D543-101010|EDFF52-101010", 0, 1, intX, intY
                    End If
                        

                    If intX > -1 And intY > -1 Then
                            
                            
                        If isTuTuL = True Then 
                            ShowMessage "获取蓝色精炼石"
                            TracePrint "获取蓝色精炼石"
                            If isSF = True Then 
                                RandomClickInRect 233,676,281-233,819-676, 1	//私服点击获取精炼石233,676,281,819
                            Else 
                                RandomClickInRect 188,674,237-188,821-674, 1	//点击获取新异界精炼石188,674,237,821
                            End If
                                
                            SL = SL + 1
                        Else 	
                            ShowMessage "出售蓝色精炼石"
                            TracePrint "出售蓝色精炼石"
                            If isSF = True Then 
                                RandomClickInRect 231,459,285-231,606-459, 1	//私服点击出售精炼石231,459,285,606
                            Else 
                                RandomClickInRect 189,459,237-189,605-459, 1	//点击异界新出售精炼石189,459,237,605
                            End If
                                
                        End If
                        
                    Else 
                        //判断是不是绿色精炼石
                        If isSF = True Then 
                            FindColor 440,515,487,733,"61D304-202020|4AB10F-202020",0,1,intX,intY
                        Else 
                            FindColor 438, 518, 518, 803, "61D304-101010|47AD11-101010", 0, 1, intX, intY
                        End If

                        If intX > -1 And intY > -1 Then
                            TracePrint "绿色精炼石"
                            ShowMessage "出售绿色精炼石"
                            If isSF = True Then 
                                RandomClickInRect 231,459,285-231,606-459, 1	//私服点击出售精炼石231,459,285,606
                            Else 
                                RandomClickInRect 189,459,237-189,605-459, 1	//点击异界新出售精炼石189,459,237,605
                            End If
                        Else 
                            TracePrint "橙色精炼石"
                            ShowMessage "橙色精炼石-强制获取"
                            If isSF = True Then 
                                RandomClickInRect 233,676,281-233,819-676, 1	//私服点击获取精炼石233,676,281,819
                            Else 
                                RandomClickInRect 188,674,237-188,821-674, 1	//点击获取新异界精炼石188,674,237,821
                            End If
                            SC = SC + 1
                        End If
                    End If
                End If
            Else 
                //点击确认
                    
                TracePrint "材料"
                    
                比例触摸_随机点 152,573,194,704	//掉落材料,点击确认
            End If
        Case 3
            //突袭模式
            isTuTuL = ReadUIConfig("蓝色精炼",true)
            isTuTuZ = ReadUIConfig("紫色精炼",true)
                
            If stone = 1 Then 
                //说明是精炼石，判断颜色
                //                    Dim intX,intY
                //判断是不是紫色精炼石
 
                If isSF = True Then 
                    FindColor 439,517,489,766,"FF8CF3-202020|BA5FC1-202020",0,1,intX,intY	//私服找紫色
                Else 
                    FindColor 438, 518, 518, 803, "D470D4-101010|FF8CF3-101010", 0, 1, intX, intY
                End If

                If intX > -1 And intY > -1 Then 
                        
                    TracePrint "紫色精炼石"
                    If isTuTuZ = True Then 
                        ShowMessage "获取紫色精炼石"
                        If isSF = True Then 
                            RandomClickInRect 238,683,277-238,812-683, 1	//私服点击获取精炼石 238,683,277,812
                        Else 
                            RandomClickInRect 189,678,236-189,819-678, 1	//点击获取精炼石189,678,236,819
                        End If
                        SZ = SZ + 1
                    Else 
                        ShowMessage "出售紫色精炼石"
                        If isSF = True Then 
                            RandomClickInRect 231,459,285-231,606-459, 1	//私服点击出售精炼石231,459,285,606
                            RandomClickInRect 264,459,308-264,596-459, 1	//点击是264,459,308,596 
                        Else 
                            RandomClickInRect 189,464,231-189,605-464, 1	//点击出售精炼石189,464,231,605
                            RandomClickInRect 264,459,308-264,596-459, 1	//点击是264,459,308,596 
                        End If
                    End If
                Else 
                        
                    //判断是不是蓝色精炼石
                    If isSF = True Then 
                        FindColor 438, 513, 490, 805, "EDFF52-202020|D0CA3F-202020", 0, 1, intX, intY
                    Else 
                        FindColor 438, 518, 518, 803, "D6D543-101010|EDFF52-101010", 0, 1, intX, intY
                    End If
                        

                    If intX > -1 And intY > -1 Then
                            
                            
                        If isTuTuL = True Then 
                            ShowMessage "获取蓝色精炼石"
                            TracePrint "获取蓝色精炼石"
                            If isSF = True Then 
                                RandomClickInRect 233,676,281-233,819-676, 1	//私服点击获取精炼石233,676,281,819
                            Else 
                                RandomClickInRect 189,678,236-189,819-678, 1	//点击获取精炼石189,678,236,819
                            End If
                                
                            SL = SL + 1
                        Else 	
                            ShowMessage "出售蓝色精炼石"
                            TracePrint "出售蓝色精炼石"
                            If isSF = True Then 
                                RandomClickInRect 231,459,285-231,606-459, 1	//私服点击出售精炼石231,459,285,606
                            Else 
                                RandomClickInRect 189,464,231-189,605-464, 1	//点击出售精炼石189,464,231,605
                            End If
                                
                        End If
                        
                    Else 
                        //判断是不是绿色精炼石
                        If isSF = True Then 
                            FindColor 440,515,487,733,"61D304-202020|4AB10F-202020",0,1,intX,intY
                        Else 
                            FindColor 438, 518, 518, 803, "61D304-101010|47AD11-101010", 0, 1, intX, intY
                        End If

                        If intX > -1 And intY > -1 Then
                            TracePrint "绿色精炼石"
                            ShowMessage "出售绿色精炼石"
                            If isSF = True Then 
                                RandomClickInRect 231,459,285-231,606-459, 1	//私服点击出售精炼石231,459,285,606
                            Else 
                                RandomClickInRect 189,464,231-189,605-464, 1	//点击出售精炼石189,464,231,605
                            End If
                        Else 
                            TracePrint "橙色精炼石"
                            ShowMessage "橙色精炼石-强制获取"
                            If isSF = True Then 
                                RandomClickInRect 233,676,281-233,819-676, 1	//私服点击获取精炼石233,676,281,819
                            Else 
                                RandomClickInRect 189,678,236-189,819-678, 1	//点击获取精炼石189,678,236,819
                            End If
                            SC = SC + 1
                        End If
                    End If
                End If
            Else 
                //点击确认
                    
                TracePrint "材料"
                    
                比例触摸_随机点 192,582,233,693	//掉落材料,点击确定
            End If
                
        End Select
        

        
    Case 1,2 
        //普通符文|魔法符文都是卖  108,455,171,612地下出售 151,453,217,613 异界地下出售
        Select Case star
        Case 0
            ShowMessage "出售魔法以下神器"
            TracePrint  "出售魔法以下神器"
            RandomClickInRect 151,455,171-151,613-455, 1 	//点击出售 异界和地下重用
            RandomClickInRect 255,446,317-255,607-446, 1	//点击是
        Case 1, 2, 3, 4
            //出售1-4星
            ShowMessage "出售魔法以下符文"
            TracePrint  "出售魔法以下符文"
            RandomClickInRect 151,455,171-151,613-455, 1 	//点击出售 异界和地下重用
        Case 5, 6
            //出售5-6星
            ShowMessage "出售魔法以下符文"
            TracePrint  "出售魔法以下符文"
            RandomClickInRect 151,455,171-151,613-455, 1 	//点击出售 异界和地下重用
            RandomClickInRect 255,446,317-255,607-446, 1	//点击是    
        End Select
    Case 3
        //稀有符文
        
        Select Case star
        Case 0
            If 蓝色神器 = True Then 
                RandomClickInRect 153,668,172-153,828-668, 1	//点击获取符文 异界和地下重用
                蓝色神器数 = 蓝色神器数 + 1
            Else 
                ShowMessage "出售蓝色神器"
                TracePrint  "出售蓝色神器"
                RandomClickInRect 151,455,171-151,613-455, 1 	//点击出售 异界和地下重用
                RandomClickInRect 255,446,317-255,607-446, 1	//点击是 
            End If
        Case 1, 2, 3, 4
            If isChooseALL = True Then 
                RandomClickInRect 153,668,172-153,828-668, 1	//点击获取符文 异界和地下重用
            Else 
                //出售1-4星
                ShowMessage "出售四星以下符文"
                TracePrint  "出售四星以下符文"
                RandomClickInRect 151,455,171-151,613-455, 1 	//点击出售 异界和地下重用
            End If
            
        Case 5
            If isChooseALL = True Then 
                RandomClickInRect 153,668,172-153,828-668, 1	//点击获取符文 异界和地下重用
            Else 
                //出售5星
                ShowMessage "出售五星稀有符文"
                TracePrint  "出售五星稀有符文"
                RandomClickInRect 151,455,171-151,613-455, 1 	//点击出售 异界和地下重用
                RandomClickInRect 255,446,317-255,607-446, 1	//点击是 
            End If
        Case 6
            //六星稀有,需要判断主属性和速度
            If isChooseALL = True Then 
                RandomClickInRect 153,668,172-153,828-668, 1	//点击获取符文 异界和地下重用
                L6 = L6 + 1
            Else 
                isChoose6L = ReadUIConfig("6L", true)
                isSpeed = ReadUIConfig("6LSX", false)
                If isChoose6L = True Then 
                    If isSpeed = True Then 
                        //筛选主属性和速度249,385,401,741  254,401,402,659
                        If FilterSpeed(6) = True Then 
                            ShowMessage "保留蓝色六星"
                            TracePrint "保留蓝色六星"
                            RandomClickInRect 153,668,172-153,828-668, 1	//点击获取符文 异界和地下重用
                            L6 = L6 + 1
                        Else 
                            TracePrint "没筛选到,卖掉"
                            ShowMessage "出售蓝色六星"
                            TracePrint "出售蓝色六星"
                            RandomClickInRect 151,455,171-151,613-455, 1 	//点击出售 异界和地下重用
                            RandomClickInRect 255,446,317-255,607-446, 1	//点击是
                        End If
                    Else 
                        ShowMessage "保留蓝色六星"
                        TracePrint "保留蓝色六星"
                        RandomClickInRect 153,668,172-153,828-668, 1	//点击获取符文 异界和地下重用
                        L6 = L6 + 1
                    End If
                    
                Else 
                    ShowMessage "出售蓝色六星"
                    TracePrint "出售蓝色六星"
                    RandomClickInRect 151,455,171-151,613-455, 1 	//点击出售 异界和地下重用
                    RandomClickInRect 255,446,317-255,607-446, 1	//点击是
                End If
            End If
        End Select
    Case 4
        //英雄符文
        Select Case star
        Case 0
            If 紫色神器 = True Then 
                RandomClickInRect 153,668,172-153,828-668, 1	//点击获取符文 异界和地下重用
                紫色神器数 = 紫色神器数 + 1
            Else 
                ShowMessage "出售紫色神器"
                TracePrint  "出售紫色神器"
                RandomClickInRect 151,455,171-151,613-455, 1 	//点击出售 异界和地下重用
                RandomClickInRect 255,446,317-255,607-446, 1	//点击是 
            End If
        Case 1, 2, 3, 4
            If isChooseALL = True Then 
                RandomClickInRect 153,668,172-153,828-668, 1	//点击获取符文 异界和地下重用
            Else 
                //出售1-4星
                ShowMessage "出售四星以下符文"
                TracePrint  "出售四星以下符文"
                RandomClickInRect 151,455,171-151,613-455, 1 	//点击出售 异界和地下重用
            End If
        Case 5
            //5星英雄符文
            If isChooseALL = True Then 
                RandomClickInRect 153,668,172-153,828-668, 1	//点击获取符文 异界和地下重用
                Z5 = Z5 + 1
            Else 
                isChoose5Z = ReadUIConfig("5Z", true)
                isSpeed = ReadUIConfig("5ZSX", false)
                If isChoose5Z = True Then                 	
                    If isSpeed = True Then 
                        //筛选速度249,385,401,741
                        If FilterSpeed(5) = True Then 
                            ShowMessage "保留五星紫色"
                            TracePrint "保留五星紫色"
                            RandomClickInRect 153,668,172-153,828-668, 1	//点击获取符文 异界和地下重用
                            Z5 = Z5 + 1
                        Else                            
                            ShowMessage "出售五星紫色"
                            TracePrint "出售五星紫色"
                            RandomClickInRect 151,455,171-151,613-455, 1 	//点击出售 异界和地下重用
                            RandomClickInRect 255,446,317-255,607-446, 1	//点击是
                        End If
                    Else 
                        ShowMessage "保留五星紫色"
                        TracePrint "保留五星紫色"
                        RandomClickInRect 153,668,172-153,828-668, 1	//点击获取符文 异界和地下重用
                        Z5 = Z5 + 1
                    End If
  
                Else 
                    ShowMessage "出售五星紫色"
                    TracePrint "出售五星紫色"
                    RandomClickInRect 151,455,171-151,613-455, 1 	//点击出售 异界和地下重用
                    RandomClickInRect 255,446,317-255,607-446, 1	//点击是
                End If
            End If
        Case 6
            //6星英雄
            If isChooseALL = True Then 
                RandomClickInRect 153,668,172-153,828-668, 1	//点击获取符文 异界和地下重用
                Z6 = Z6 + 1
            Else 
                isChoose6Z = ReadUIConfig("6Z", true)
                isSpeed = ReadUIConfig("6ZSX", false)
                If isChoose6Z = True Then 
                	
                    If isSpeed = True Then 
                        //筛选速度249,385,401,741
                        If FilterSpeed(6) = True Then 
                            
                            ShowMessage "保留六星紫色"
                            TracePrint "保留六星紫色"
                            RandomClickInRect 153,668,172-153,828-668, 1	//点击获取符文 异界和地下重用
                            Z6 = Z6 + 1
                        Else 
                            
                            ShowMessage "出售六星紫色"
                            TracePrint "出售六星紫色"
                            RandomClickInRect 151,455,171-151,613-455, 1 	//点击出售 异界和地下重用
                            RandomClickInRect 255,446,317-255,607-446, 1	//点击是
                        End If
                    Else 
                        ShowMessage "保留六星紫色"
                        TracePrint "保留六星紫色"
                        RandomClickInRect 153,668,172-153,828-668, 1	//点击获取符文 异界和地下重用
                        Z6 = Z6 + 1
                    End If
                	
                    
                Else 
                    ShowMessage "出售六星紫色"
                    TracePrint "出售六星紫色"
                    RandomClickInRect 151,455,171-151,613-455, 1 	//点击出售 异界和地下重用
                    RandomClickInRect 255,446,317-255,607-446, 1	//点击是
                End If
            End If
        End Select
    Case 5
        //传说符文
        Select Case star
        Case 0
            ShowMessage "强制保留橙色神器"
            TracePrint "强制保留橙色神器"
            RandomClickInRect 153,668,172-153,828-668, 1	//点击获取符文 异界和地下重用 
            橙色神器数 = 橙色神器数 + 1
        Case 1, 2, 3, 4
            If isChooseALL = True Then 
                RandomClickInRect 153,668,172-153,828-668, 1	//点击获取符文 异界和地下重用
            Else 
                //出售1-4星
                ShowMessage "出售四星以下符文"
                TracePrint  "出售四星以下符文"
                RandomClickInRect 151,455,171-151,613-455, 1 	//点击出售 异界和地下重用
            End If
        Case 5
            If isChooseALL = True Then 
                RandomClickInRect 153,668,172-153,828-668, 1	//点击获取符文 异界和地下重用
                C5 = C5 + 1
            Else 
                //5星传说符文
                isChoose5C = ReadUIConfig("5C", true)
                isSpeed = ReadUIConfig("5CSX", false)
                If isChoose5C = True Then 
                    If isSpeed = True Then 
                        //筛选速度249,385,401,741
                        If FilterSpeed(5) = True Then 
                            
                            ShowMessage "保留五星橙色"
                            TracePrint "保留五星橙色"
                            RandomClickInRect 153,668,172-153,828-668, 1	//点击获取符文 异界和地下重用
                            C5 = C5 + 1
                        Else 
                            
                            ShowMessage "出售五星橙色"
                            TracePrint "出售五星橙色"
                            RandomClickInRect 151,455,171-151,613-455, 1 	//点击出售 异界和地下重用
                            RandomClickInRect 255,446,317-255,607-446, 1	//点击是
                        End If
                    Else 
                        ShowMessage "保留五星橙色"
                        TracePrint "保留五星橙色"
                        RandomClickInRect 153,668,172-153,828-668, 1	//点击获取符文 异界和地下重用
                        C5 = C5 + 1
                    End If
  
                Else 
                    ShowMessage "出售五星橙色"
                    TracePrint "出售五星橙色"
                    RandomClickInRect 151,455,171-151,613-455, 1 	//点击出售 异界和地下重用
                    RandomClickInRect 255,446,317-255,607-446, 1	//点击是
                End If
            End If
        Case 6
            //6星传说  105,668,172,828 地下获取范围 153,668,216,826异界范围
            ShowMessage "保留六星橙色"
            TracePrint "保留六星橙色"
            C6 = C6 + 1
            RandomClickInRect 153,668,172-153,828-668, 1	//点击获取符文 异界和地下重用
        End Select
    End Select
        
        
        
    If type > 19 Then 
        //异界需要另外点击一下确定
        RandomClickInRect 111,565,141-111,707-565,1		//点击确认
    End If

  
    
End Function               

//判断狗粮等级并决定是否更换
Function judgeMoLingLevel(x1, y1, x2, y2)

    
    Dim mlStar = judgeMoLingStar(x1,y1,x2,y2,True)
    Dim isLevelFull = False
    TracePrint mlStar
    Select Case mlStar
    Case 1
        If customFindPic(x1-80, y1, x2-80, y2,"1") = True and customFindPic(x1-80, y1, x2-80, y2,"5") = True Then 
            TracePrint "1星魔灵已经满级"
            isLevelFull = True
           
        Else 
            TracePrint "1星魔灵未满级"
        End If	
    Case 2
        If customFindPic(x1-80, y1, x2-80, y2,"2") = True and customFindPic(x1-80, y1, x2-80, y2,"0") = True Then 
            TracePrint "2星魔灵已经满级"
            isLevelFull = True
            //            star2Finished = star2Finished + 1
        Else 
            TracePrint "2星魔灵未满级"
        End If
    Case 3
        If customFindPic(x1-80, y1, x2-80, y2,"2") = True and customFindPic(x1-80, y1, x2-80, y2,"5") = True Then 
            TracePrint "3星魔灵已经满级"
            isLevelFull = True
            //            star3Finished = star3Finished + 1
        Else 
            TracePrint "3星魔灵未满级"
        End If
    Case 4
            
        If customFindPic(x1-80, y1, x2-80, y2,"3") = True and customFindPic(x1-80, y1, x2-80, y2,"0") = True Then 
            TracePrint "4星魔灵已经满级"
            isLevelFull = True
            //            star4Finished = star4Finished + 1
        Else 
            TracePrint "4星魔灵未满级"
        End If
    Case 5
        If customFindPic(x1-80, y1, x2-80, y2,"3") = True and customFindPic(x1-80, y1, x2-80, y2,"5") = True Then 
            TracePrint "5星魔灵已经满级"
            isLevelFull = True
            
            
        Else 
            TracePrint "5星魔灵未满级"
        End If
    Case 6
        If customFindPic(x1-80, y1, x2-80, y2,"4") = True and customFindPic(x1-80, y1, x2-80, y2,"0") = True Then 
            TracePrint "6星魔灵已经满级"
            isLevelFull = True
            
        Else 
            TracePrint "6星魔灵未满级"
        End If
    Case Else
        TracePrint "该位置没有魔灵，不做处理"	
    End Select
        
    If isLevelFull = True Then 
        //        endReason = "魔灵已满级"
        //点击换下已满级的魔灵395+35, 130+35, 525, 261  434,165,487,223
        RandomClickInRect(x1-80+35, y1+35, 50, 50, 1)
        changeMoling
        //        EndScript
    End If
    

    
    
End Function

Function changeMoling
    //拿到用户的设置信息
    Dim star1 = ReadUIConfig("1星狗粮",false)
    Dim star2 = ReadUIConfig("2星狗粮",false)
    Dim star3 = ReadUIConfig("3星狗粮",false)
    Dim star4 = ReadUIConfig("4星狗粮",false)

    Rem reStartFind
    Dim isNeedChangeStar = 0

    //判断勾选星级
    TracePrint star1 , star1Finished
    TracePrint star2 , star2Finished
    TracePrint star3, star3Finished
    TracePrint star4 ,star4Finished
    
    If star1 = True and star1Finished = False Then 
        isNeedChangeStar = 1
    Else 
        If star2 = True and star2Finished = False Then 
            isNeedChangeStar = 2
        Else 
            If star3 = True and star3Finished = False Then 
                isNeedChangeStar = 3
            Else 
                If star4 = True and star4Finished = False Then 
                    isNeedChangeStar = 4
                Else 
                    //1-4星全部练完,停止脚本
                    endReason = "狗粮已练完,停止脚本"
                    stopTheScript
                End If
            End If
        End If
    End If

    //先将魔灵快速滑到最右侧
    If isScrollEnd = False Then 
        For 15
            TouchDown 230, 800, 1//按住屏幕上的100,100坐标不放，并设置此触点ID=1
            TouchMove 230, 300, 1, 200//将ID=1的触点花200毫秒移动至300,300坐标
            TouchUp 1//松开弹起ID=1的触点
            Delay 100
        Next

        //取两点颜色 
        Dim p1 = 1,p2 = 2,n1 = 11, n2 = 22

        Do Until n1 = p1 and n2 = p2
            p1 = GetPixelColor(230,715)
            p2 = GetPixelColor(230,825)

            //        zm.Swipe 230, 800, 230, 300,50	//右滑
            Swipe 230, 800, 230, 300,1

            Delay 2000
            n1 = GetPixelColor(230,715)
            n2 = GetPixelColor(230, 825)
        Loop
        TracePrint "已滑到最右"  
        isScrollEnd = True
    End If 



    Rem startFind

    //从最左到最右中寻找对应星级
    While not 比例判断魔灵星级(240,700,280,900, false) = isNeedChangeStar
    	
		
        //范围内没有该星级,需要滑动再找
        p1 = GetPixelColor(230,715)
        p2 = GetPixelColor(230,825)
            
        
        zm.Swipe 230, 300, 230, 300+108, 500	//右滑

        Delay 100
        n1 = GetPixelColor(230,715)
        n2 = GetPixelColor(230,825)
        
        //判断当前范围是不是5星，是5星，则认为滑动到最左
        If 比例判断魔灵星级(240,700,280,900, false) = 5 or 比例判断魔灵星级(240,700,280,900, false) = 6 Then 
            n1 = p1
            n2 = p2
        End If
   
        If n1 = p1 and n2 = p2 Then 
            TracePrint "已滑到最左"

            //所有魔灵均没有对应星级,设置为最大
            Select Case isNeedChangeStar
            Case 1
                star1Finished = True
        
            Case 2
                star2Finished = True
            Case 3
                star3Finished = True
            Case 4
                star4Finished = True

            Case Else
                TracePrint "魔灵星级异常"	
            End Select
                
            Goto reStartFind
            
        End If


    Wend
    TracePrint "找到符合星级魔灵"
    TracePrint x,y
    Dim x1 = x - 100, y1 = y, x2 = x, y2 = y + 100
    Dim tempP = x,tempQ = y
    //判断是不是满级了
    Dim isFullLevel = False
    Select Case isNeedChangeStar
    Case 1
        If customFindPic(x1, y1, x2, y2,"1") = True and customFindPic(x1, y1, x2, y2,"5") = True Then 
            TracePrint "1星魔灵已经满级"
            isFullLevel = True
        Else 
            TracePrint "1星魔灵未满级"

        End If	
    Case 2
        If customFindPic(x1, y1, x2, y2,"2") = True and customFindPic(x1, y1, x2, y2,"0") = True Then 
            TracePrint "2星魔灵已经满级"
            isFullLevel = True
        Else 
            TracePrint "2星魔灵未满级"
        End If
    Case 3
        If customFindPic(x1, y1, x2, y2,"2") = True and customFindPic(x1, y1, x2, y2,"5") = True Then 
            TracePrint "3星魔灵已经满级"
            isFullLevel = True
        Else 
            TracePrint "3星魔灵未满级"
        End If
    Case 4
            
        If customFindPic(x1, y1, x2, y2,"3") = True and customFindPic(x1, y1, x2, y2,"0") = True Then 
            TracePrint "4星魔灵已经满级"
            isFullLevel = True
        Else 
            TracePrint "4星魔灵未满级"
        End If

    Case Else
        TracePrint "魔灵星级异常"	
    End Select
    
    If isFullLevel = False and 880 - tempQ > 50 Then 
        RandomClickInRectNoCheck tempP - 50, tempQ, 50, 50, 1
    Else 
        //找到星级了但是满级了,继续遍历
        p1 = GetPixelColor(230,715)
        p2 = GetPixelColor(230,825)
            
        
        zm.Swipe 230, 300, 230, 300+108, 500	//右滑
        //            maxY = 900	//复位
        //            minY = 850
        Delay 300
        n1 = GetPixelColor(230,715)
        n2 = GetPixelColor(230,825)
            
        If n1 = p1 and n2 = p2 Then 
            TracePrint "已滑到最左"

            //所有魔灵均没有对应星级,设置为最大
            Select Case isNeedChangeStar
            Case 1
                star1Finished = True
        
            Case 2
                star2Finished = True
            Case 3
                star3Finished = True
            Case 4
                star4Finished = True

            Case Else
                TracePrint "魔灵星级异常"	
            End Select
                
            Goto reStartFind
            
        End If
        Goto startFind
    End If
    
    
    
    
End Function

//判断魔灵星级1-6 异常返回0
Function judgeMoLingStar(x1,y1,x2,y2,isTop)

    If isTop = True Then 
        If customFindPic(x1,y1,x2,y2,"黄色狗粮六星") = true or customFindPic(x1,y1,x2,y2,"红色狗粮六星") = true Then 
            judgeMoLingStar = 6
        Else
            If customFindPic(x1,y1,x2,y2,"黄色狗粮五星") = true or customFindPic(x1,y1,x2,y2,"红色狗粮五星") = true Then 
                judgeMoLingStar = 5
            Else
                //判断是不是四星
                If customFindPic(x1,y1,x2,y2,"黄色狗粮四星") = true or customFindPic(x1,y1,x2,y2,"红色狗粮四星") = true or _
    customFindPic(x1,y1,x2,y2,"白色狗粮四星") = true Then
                
                    judgeMoLingStar = 4
                Else 
                    //判断是不是三星
                    If customFindPic(x1,y1,x2,y2,"黄色狗粮三星") = true or customFindPic(x1,y1,x2,y2,"红色狗粮三星") = true or _
    customFindPic(x1,y1,x2,y2,"白色狗粮三星") = true Then
                
                        judgeMoLingStar = 3
                    Else 
                        //判断是不是二星
                        If customFindPic(x1,y1,x2,y2,"黄色狗粮二星") = true or customFindPic(x1,y1,x2,y2,"红色狗粮二星") = true or _
    customFindPic(x1,y1,x2,y2,"白色狗粮二星") = true Then
                
                            judgeMoLingStar = 2
                        Else 
                            //判断是不是一星
                            If customFindPic(x1,y1,x2,y2,"黄色狗粮一星") = true or customFindPic(x1,y1,x2,y2,"红色狗粮一星") = true or _
    customFindPic(x1,y1,x2,y2,"白色狗粮一星") = true Then 
                   
                                judgeMoLingStar = 1
                            Else 
                   
                                judgeMoLingStar = 0
                            End If	
                        End If	
                    End If	
                End If	
            End If
        End If
    Else 
        If customFindPic(x1,y1,x2,y2,"黄色狗粮六星下") = true or customFindPic(x1,y1,x2,y2,"红色狗粮六星下") = true Then 
            judgeMoLingStar = 6
        Else
            If customFindPic(x1,y1,x2,y2,"黄色狗粮五星下") = true or customFindPic(x1,y1,x2,y2,"红色狗粮五星下") = true Then 
                judgeMoLingStar = 5
            Else
                //判断是不是四星
                If customFindPic(x1,y1,x2,y2,"黄色狗粮四星下") = true or customFindPic(x1,y1,x2,y2,"红色狗粮四星下") = true or _
    customFindPic(x1,y1,x2,y2,"白色狗粮四星下") = true  Then
                
                    judgeMoLingStar = 4
                Else 
                    //判断是不是三星
                    If customFindPic(x1,y1,x2,y2,"黄色狗粮三星下") = true or customFindPic(x1,y1,x2,y2,"红色狗粮三星下") = true  or _
    customFindPic(x1,y1,x2,y2,"白色狗粮三星下") = true Then
                
                        judgeMoLingStar = 3
                    Else 
                        //判断是不是二星
                        If customFindPic(x1,y1,x2,y2,"黄色狗粮二星下") = true or customFindPic(x1,y1,x2,y2,"红色狗粮二星下") = true or _
    customFindPic(x1,y1,x2,y2,"白色狗粮二星下") = true Then
                
                            judgeMoLingStar = 2
                        Else 
                            //判断是不是一星
                            If customFindPic(x1,y1,x2,y2,"黄色狗粮一星下") = true or customFindPic(x1,y1,x2,y2,"红色狗粮一星下") = true or _
    customFindPic(x1,y1,x2,y2,"白色狗粮一星下") = true Then 
                   
                                judgeMoLingStar = 1
                            Else 
                   
                                judgeMoLingStar = 0
                            End If	
                        End If	
                    End If	
                End If	
            End If
        End If 
    End If
    
End Function

Function 数组插入坐标(x1,y1,x2,y2,arr)
    Dim tempArr = arr
    tempArr = zm.ArrayInsert (tempArr, y2, 0, True)
    tempArr = zm.ArrayInsert (tempArr, x2, 0, True)
    tempArr = zm.ArrayInsert (tempArr, y1, 0, True)
    tempArr = zm.ArrayInsert(tempArr, x1, 0, True)
    数组插入坐标 = tempArr
    //        TracePrint zm.VarInfo(tempArr)
    //        TracePrint zm.VarInfo(黄色一星狗粮下)
End Function

Function 比例判断魔灵星级(x1,y1,x2,y2,isTop)

    If isTop = False Then 
	
        If 比例找色(数组插入坐标(x1, y1, x2, y2, 红色六星狗粮下)) = 1 Then 
            比例判断魔灵星级 = 6
        ElseIf 比例找色(数组插入坐标(x1, y1, x2, y2, 黄色五星狗粮下)) = 1 or 比例找色(数组插入坐标(x1, y1, x2, y2, 红色五星狗粮下)) = 1 Then
            比例判断魔灵星级 = 5
        ElseIf 比例找色(数组插入坐标(x1, y1, x2, y2, 黄色四星狗粮下)) = 1 or 比例找色(数组插入坐标(x1, y1, x2, y2, 红色四星狗粮下)) = 1 Then
            比例判断魔灵星级 = 4
        ElseIf 比例找色(数组插入坐标(x1, y1, x2, y2, 黄色三星狗粮下)) = 1 or 比例找色(数组插入坐标(x1, y1, x2, y2, 红色三星狗粮下)) = 1 Then
            比例判断魔灵星级 = 3
        ElseIf 比例找色(数组插入坐标(x1, y1, x2, y2, 黄色二星狗粮下)) = 1 or 比例找色(数组插入坐标(x1, y1, x2, y2, 红色二星狗粮下)) = 1 or 比例找色(数组插入坐标(x1, y1, x2, y2, 白色二星狗粮下)) = 1 Then
            比例判断魔灵星级 = 2
        ElseIf 比例找色(数组插入坐标(x1, y1, x2, y2, 黄色一星狗粮下)) = 1 or 比例找色(数组插入坐标(x1, y1, x2, y2, 红色一星狗粮下)) = 1 or 比例找色(数组插入坐标(x1, y1, x2, y2, 白色一星狗粮下)) = 1 Then
			
            比例判断魔灵星级 = 1
        Else 
            比例判断魔灵星级 = 0	
			
        End If
    Else 
        dim topResult = judgeMoLingStar(x1,y1,x2,y2,isTop)
        比例判断魔灵星级 = topResult
	
    End If
    
End Function

//判断强化星级1-6异常返回0
Function judgeQiangHuaStar(x1,y1,x2,y2)

	
    If customFindPic(x1,y1,x2,y2,"强化三星黄色") = True or customFindPic(x1,y1,x2,y2,"强化三星红色") = True Then 
        judgeQiangHuaStar = 3
    Else 
        If customFindPic(x1, y1, x2, y2, "强化二星黄色") = True or customFindPic(x1, y1, x2, y2, "强化二星红色") = True or customFindPic(x1, y1, x2, y2, "强化二星白色") = True Then 
            judgeQiangHuaStar = 2
        Else 
            judgeQiangHuaStar = 0
        End If
        
    End If	

End Function

//判断强化星级1-6异常返回0
Function judgeQiangHuaLevel(x1,y1,x2,y2)

	
    Dim mlStar = judgeQiangHuaStar(x1,y1,x2,y2)
    Dim isLevelFull = False
    TracePrint mlStar
    Select Case mlStar

    Case 2
        If customFindPic(x1,y1,x2,y2,"20") = True Then 
            TracePrint "2星魔灵满级"
            isLevelFull = True
        Else 
            TracePrint "2星魔灵未满级"
        End If
    Case 3
        If zm.FindMultiColor(x1,y1,x2,y2,findPicTb["25"]["起点颜色"],findPicTb["25"]["偏移"], 0.9,"显示") Then 
            TracePrint "3星魔灵已经满级"
            isLevelFull = True
        Else 
            TracePrint "3星魔灵未满级"
        End If

    Case Else
        TracePrint "没有找到2星或者3星魔灵"	
    End Select
        
    If isLevelFull = True Then 
        endReason = "魔灵已满级"
        //        changeMoling
        EndScript
    End If

End Function


Function judgeFuWenLevel(x1,y1,x2,y2)
    //判断符文星级 

    //判断是不是六星
    If 比例找色(白色六星) = 1 or customFindPic(x1,y1,x2,y2,"异界六星") = True Then
            
        judgeFuWenLevel = 6
    Else 
        //判断是不是五星
        If customFindPic(x1,y1,x2,y2,"白色五星") = True or customFindPic(x1,y1,x2,y2,"异界五星") = True Then
                
            judgeFuWenLevel = 5
        Else 
            //判断是不是四星
            If customFindPic(x1,y1,x2,y2,"白色四星") = True or customFindPic(x1,y1,x2,y2,"异界四星") = True Then
                
                judgeFuWenLevel = 4
            Else 
                //判断是不是三星
                If customFindPic(x1,y1,x2,y2,"白色三星") = True or customFindPic(x1,y1,x2,y2,"异界三星") = True Then
                
                    judgeFuWenLevel = 3
                Else 
                    //判断是不是二星
                    If customFindPic(x1,y1,x2,y2,"白色二星") = True or customFindPic(x1,y1,x2,y2,"异界二星") = True Then
                
                        judgeFuWenLevel = 2
                    Else 
                        //判断是不是一星
                        If customFindPic(x1,y1,x2,y2,"白色一星") = True or customFindPic(x1,y1,x2,y2,"异界一星") = True Then
                
                            judgeFuWenLevel = 1
                        Else 
                            //不是1-6星,判断是不是材料
                            judgeFuWenLevel = 0
                        End If	
                    End If	
                End If	
            End If	
        End If
    End If

End Function

//普通-传说对应1-5,没找到返回0,说明不是符文
Function judgeFuwenColor(x1,y1,x2,y2)

    Dim isSF = ReadUIConfig("私服",false)
    If isSF = True Then 
    	
        //私服判断
        //先判断是不是材料22,458,231,799
        If customFindPic(22,458,231,799, "确认弹框") = True Then 
            judgeFuwenColor = 0
    	
        Else 
            Delay 100
            If CustomFindColors(500,521,544,693, "私服传说") = True Then 
                //传说符文,返回5
                judgeFuwenColor = 5
        
            Else 
                //判断是不是英雄
                Delay 100
                If CustomFindColors(500,521,544,693, "私服英雄") = True Then 
                    //普通
                    judgeFuwenColor = 4
           
                Else 
                    Delay 100
                    If CustomFindColors(500,521,544,693, "私服稀有") = True Then 
                        //魔法
                        judgeFuwenColor = 3
                
                    Else 
                        Delay 100
                        If CustomFindColors(500,521,544,693, "私服魔法") = True Then 
                            //稀有
                            judgeFuwenColor = 2
                        Else 
                            Delay 100
                            If CustomFindColors(500,521,544,693, "私服普通") = True Then 
                                //英雄
                                judgeFuwenColor = 1
                            Else 
                                judgeFuwenColor = 0
                            End If
                        End If
                    End If
                End If
            End If
        End If
        
    Else 
        //492,778,536,887  443,776,494,885
        Delay 100
        If CustomFindColors(x1,y1,x2,y2,"官服传说") = True Then 
            //传说符文
            judgeFuwenColor = 5
        
        Else 
            
            Delay 100
            If CustomFindColors(x1,y1,x2,y2,"官服英雄") = True Then 
                
                judgeFuwenColor = 4
           
            Else 
                Delay 100
                If CustomFindColors(x1,y1,x2,y2,"官服稀有") = True Then 
                    
                    judgeFuwenColor = 3
                
                Else 
                    Delay 100
                    If CustomFindColors(x1,y1,x2,y2,"官服魔法") = True Then 
                        
                        judgeFuwenColor = 2
                        Delay 100
                    Else 
                        Delay 100
                        If CustomFindColors(x1,y1,x2,y2,"官服普通") = True Then 
                            
                            judgeFuwenColor = 1
                        Else 
                            //不是符文
                            judgeFuwenColor = 0
                        End If
                    End If
                End If
            End If
        End If
    End If
    

	
End Function

Function judgeTimes()
    //判断是否达到翻车次数
    totalFailedTimes = CInt(ReadUIConfig("翻车次数输入框", 999))
    totalTimes =  CInt(ReadUIConfig("战斗次数输入框",999))
    If failure > totalFailedTimes or failure + success > totalTimes Then 
        TracePrint "达到次数停止条件,停止脚本"
        endReason = "达到次数停止条件~"
        If type = 3 Then 
            //突袭达到次数点击否,退出队伍267,692,305,816
            比例触摸_随机点 267,692,305,816
        End If
        stopTheScript
    End If
End Function


Sub checkIsTimeOut(seconds)
    Dim index = seconds
    While index > 0
        ShowMessage ("等待倒计时:" & index),3000,0,0 
        index = index - 1
        Delay 1000
    Wend
    Thread.SetShareVar "Timeout", 1	
End Sub


Function judgeTiLi()

    If customFindPic(424,510,495,754,"体力弹框") = True Then
        TracePrint "能量不足"
        //能量不足，判断当前红水消耗量是否达到预设值。
        totalBuyTimes = CInt(ReadUIConfig("买体次数输入框",999))
        If not buyTimes < totalBuyTimes Then 
            //买体次数达到限制,停止脚本
            ShowMessage "达到买体停止条件,停止脚本"
            endReason = "达到次数停止条件~"
            stopTheScript
        End If
        
        //先判断邮箱是不是灰色"271|726|56747C-101010"
        If CmpColorEx("271|726|56747C-101010", 1) = 1 Then 
            TracePrint "邮箱不足,红水购买"
            RandomClickInRect 245,428,303-245,610-428, 1 //能量不足,点击从商店购买

        Else 
            //从邮箱领取
            RandomClickInRect 243,669,305-243,853-669, 1 //点击先从邮箱领取
            //这里要判断收件箱还有没有体力
            If CmpColorEx("475|860|5E9CC3-101010", 1) = 1 Then 
                //还有体力
                RandomClickInRectNoCheck 439,754,486-439,870-754, 1	//点击领取
                Delay 1500
                RandomClickInRect 562,902,603-562,944-902, 1	//点击关闭
                    
                If type = 3 Then 
                    比例触摸_随机点 572,572,655,669	//突袭模式需要额外点击一下
                End If
                Exit Function
                
            Else 
                //邮箱体力不足
                TracePrint "邮箱体力不足"
                RandomClickInRect 562,902,603-562,944-902, 1	//点击关闭
                Select Case type
                Case 0,2
                    RandomClickInRect 298,327,363-298,590-327, 1//点击再来一次
                    RandomClickInRect 245,428,303-245,610-428, 1 //能量不足,点击从商店购买
                Case 1
                    //爬塔
                    RandomClickInRect 1015,485,1239-1015,576-485, 1//能量足，点击开始战斗
                    RandomClickInRect 446,434,637-446,497-434, 1 //能量不足,点击从商店购买
                Case 3
                    //突袭
                    RandomClickInRectNoCheck 276,321,659-276,979-321,1	//随机点击一次
                    RandomClickInRect 257,446,302-257,612-446,1 //点击是
                    RandomClickInRect 446,434,637-446,497-434, 1 //能量不足,点击从商店购买
                End Select
            
            End If
        End If
        
        

        //这里可能就已经弹出答题界面了,需要判断一下
        If isQuestionExist() = True Then
            judgeQuestion 
        Else 
            RandomClickInRect 214,432,461-214,613-432,1 //购买体力
            //这里也可能弹出答题界面,需要判断一下
            If isQuestionExist() = True Then  
                judgeQuestion 
            Else 
                RandomClickInRect 257,446,302-257,612-446,1 //点击是    
                Delay 3000
                judgeQuestion
            End If
            
            
        End If

        judgeTiLi = True
    Else 
        judgeTiLi = False
        TracePrint "能量充足"
    End If
    
    

End Function


Function getColorArr(name)

    Dim path = "/system/bin/" & name & ".txt"
    Dim txts = zm.FileReadForm(path, ":")
    //    For Each v In txts
    //        TracePrint v[1], v[2] 
    //        dim arr = Split(v[2],",")
    //        TracePrint zm.VarInfo(arr) 
    //    Next
    //    TracePrint zm.VarInfo(txts)
    getColorArr = txts
End Function

Function isQuestionExist()
    If 比例找色(答题沙漏) = 1 Then 

        TracePrint "出现答题"

        isQuestionExist = True
    Else 
        TracePrint "没有出现答题"
        isQuestionExist = False
    End If
End Function

Function FilterSpeed(level)
    //副属速度256,398,399,694 
    //主属速度439,508,496,757

    If level = 5 Then 


        If 找图(250,395,402,735, "速度.bmp") = 1 Then
            TracePrint "筛选到五星副属速度,保留"
            FilterSpeed = True
               
        Else 
            If 找图(440,508,496,740, "主速度.bmp") = 1 Then
                TracePrint "筛选到五星主属性速度,出售"
                FilterSpeed = False
            Else
                TracePrint "没有筛选到五星速度,出售"
                FilterSpeed = False
            End If
        End If
		
    Else 
        //6星
        If 找图(250,395,402,735, "速度.bmp") = 1 Then
            TracePrint "筛选到六星副属速度,保留"
            FilterSpeed = True

        Else
            If 找图(440,508,496,740, "主速度.bmp") = 1 Then
                TracePrint "筛选到六星主属性速度,保留"
                FilterSpeed = True
            Else 
                TracePrint "没有筛选到六星速度,也暂时保留"
                FilterSpeed = True
            End If
            
            
        End If
    End If
    
End Function

Sub sendEmail

    Dim 服务器 ="smtp.163.com"
    Dim 发件人邮箱 = "tangyi_get@163.com"
    Dim 密码 = "tangyi4869"
    Dim 主题 = "答题通知"
    Dim 内容 = "出现了答题"
    Dim 收件地址 = "1070824493@qq.com"
    Dim 返回发送结果 = SendSimpleEmail(服务器,发件人邮箱,密码,主题,内容,收件地址) 
    TracePrint 返回发送结果
End Sub


Function judgeQuestion()


    //判断是否弹出答题界面 
    If isQuestionExist() = True Then
        TracePrint "出现了答题"
        dim ret = zm.OcrBaiDu(483,422,546,852)
        If ret = "" Then 
            ShowMessage "识别结果异常"
            TracePrint "识别结果异常"
        Else 
            TracePrint "识别结果:" & ret
            ShowMessage "识别结果:", ret
        End If

        falseTime = 0
        
        Rem question
        //先截图答题
        Dim fileName = "/" & Replace(GetNetworkTime()," ","-")  &".png" 
        SnapShot dirPath & fileName
        TracePrint dirPath & fileName
        If falseTime = 2 Then 

            endReason = "连续答题错误三次,停止脚本"
            //            uploadSnapToServer(fileNameArr)
            stopTheScript  

        End If

        Dim fei = UTF8.InStr(1, ret, "非")
        Dim 艾琳 = UTF8.InStr(1, ret, "艾琳")
        Dim 首领 = UTF8.InStr(1, ret, "首领")
        Dim 共 = UTF8.InStr(1, ret, "共")
        dim count = UTF8.StrGetAt(ret, 共+1)


        If not 艾琳 = 0 Then 
            //找艾琳
            judgeAnswer(1,fei,count)
		
                
        ElseIf not 首领 = 0 Then
            //找首领
            judgeAnswer(2,fei,count)
                
        Else 
            TracePrint "答题识别失败，已截图，请联系泰迪"
            endReason = "答题识别失败，已截图，请联系泰迪"
            stopTheScript
        End If
        
        //到这已经遍历完所有图标,点击确定
        RandomClickInRect 99,555,151-99,725-555,1 //点击确定    
        
        //验证答题结果
        RandomClickInRect 256,560,316-256,717-560,1 //点击确认
        

        //判断答题界面是否依旧存在,存在则说明答错了
        If isQuestionExist() = True Then  
            ShowMessage "问答错误"
            answerFalse = answerFalse + 1
            falseTime = falseTime + 1
            Goto question
        Else 
            //问答正确,上传图片
            ShowMessage "问答正确"
  
            //开启线程上传答题图片
            //            Dim thUpload = Thread.Start(uploadSnapToServer, fileNameArr)

            answerTrue = answerTrue + 1

            RandomClickInRect 254,445,307-254,618-445,1 //点击是
            RandomClickInRect 256,562,315-256,719-562,1 //点击确认
            
            RandomClickInRect 71,568,123-71,711-568,1 //点击关闭
            
            Select Case type
            Case 0
                RandomClickInRect 298,327,363-298,590-327, 1//点击再来一次
                If currentTimeResult = False Then 
                    RandomClickInRect 165,972,258-165,1189-972, 1//能量足，点击开始战斗
                End If
                    
            Case 1
                //爬塔还没改的
                If currentTimeResult = False Then 
                    RandomClickInRect 298,327,363-298,590-327, 1//点击再来一次
                End If
                RandomClickInRect 1015,485,1239-1015,576-485, 1//能量足，点击开始战斗
            End Select
            
            buyTimes = buyTimes + 1	//记录购买体力次数
        End If
		
    Else 
        //购买时可能卡住，延时一下
        Delay 3000
        比例触摸_随机点 263,573,313,713 //点击确认
        RandomClickInRect 71,568,123-71,711-568,1 //点击关闭
        Select Case type
            //地下城和异界地下城都需要点再来一次
        Case 0,2
            RandomClickInRect 298,327,363-298,590-327, 1//点击再来一次

        Case 3
            //突袭模式
            RandomClickInRectNoCheck 276,321,659-276,979-321,1	//随机点击一次

        Case 4
            //狗粮模式
          
        End Select

        buyTimes = buyTimes + 1	//记录购买体力次数
    End If
End Function


Function judgeAnswer(reg, hasFei, count)

    //八个图片的坐标  	
    Dim arr = Array(336,372,436,472,_
    335,518,438,622,_
    337,667,435,767,_
    336,812,435,912,_
    206,372,307,473,_
    208,520,306,619,_
    208,666,307,765,_
    209,813,306,911) 

        
    TracePrint "exist 非：" & hasFei
    TracePrint "答题需要寻找的内容：" & reg & "个数：" & count
    Dim didFindCount = 0
    Dim i
    
    //遍历8个坐标
    For i = 0 To 7
    
        Dim fileName = "/" & i & "-img" &".png"
        dim imgFullPath = dirPath & fileName
        SnapShot imgFullPath, arr(i*4),arr(i*4+1),arr(i*4+2),arr(i*4+3)
        Dim result = 验证答题图片(imgFullPath)
        Dim delayTime = 300
 
        //根据索引和判断结果以及非字,决定是否点击
        TracePrint "第" & i & "个服务器识别结果为：" & CInt(result)
		
        If hasFei = 0 Then 
            If result = reg Then 
                //没有非字,且为真的时候,点击
                
                比例触摸_随机点(arr(i * 4),arr(i * 4 + 1), arr(i * 4 + 2),arr(i * 4 + 3))
                didFindCount = didFindCount + 1
                Delay delayTime
            End If
                	 
        Else 
            //有非字
            If not result = reg Then 
                //有非字,且为假的时候,点击
                比例触摸_随机点(arr(i * 4),arr(i * 4 + 1), arr(i * 4 + 2),arr(i * 4 + 3))
                didFindCount = didFindCount + 1    
                Delay delayTime
            End If
        End If
        
        If didFindCount = count Then 
            Exit For
        End If             
    Next
    
                
End Function


Function CustomFindMulColor(minX, minY, maxX, maxY, tb)

    //	TracePrint minx,minY,maxX,maxY
	
    Dim result = False     
    Dim i
    
    For Each v In tb
        //                TracePrint v[1], v[2] 
        dim arr = Split(v[2],",")
        //        TracePrint zm.VarInfo(arr) 
        
        If result = True Then 
            //如果结果是true,停止循环,返回结果
            Goto didFind
        End If
        
        Dim current = True

        For Each c In arr
            Dim intX,intY
            //                        TracePrint c
            FindColor minX, minY, maxX, maxY, c, 0, 1, intX, intY		
            If intX < 0 and intY < 0 Then 
                //有一个没找到就终止循环
                current = False 
                Exit For
            Else 
                current = True
            End If
            //            TracePrint current

        Next
		
        If current = True Then 
            //找到了对应图片
            result = True
 
        End If
        
    Next
    
    
    
    Rem didFind
    CustomFindMulColor = result 
	
End Function

//随机点击方法,随机坐标随机延时检查颜色
Function RandomClickInRect(minX, minY, width, height, times)


    Dim x,y,offset        
    x = int(Rnd() * width + minX)//x的值为随机数minX - minX+width
    y = int(Rnd() * height + minY)//y的值为随机数minY - minY+height
    MoveToPointAndTap x, y,True
    If times = 2 Then 
            
        offset = int(Rnd() * 40 -20)	//在上次基础上左右各随机偏移20
        MoveToPointAndTap x+offset, y+offset,True
    End If
End Function

Function MoveToPointAndTap(x, y,check)

    Dim fColor,sColor
    
    Dim delayTime
       
    delayTime = int(Rnd() * 1000 + 500)//取1000-1500毫秒随机数
    Delay delayTime
    fColor = GetPixelColor(x,y,0)
    //        TracePrint "点击前延时：" & delayTime
    
    //点击战斗
    Tap x, y
    TracePrint "点击坐标:"&x&y

    delayTime = int(Rnd() * 1000 + 500)//取1000-1500毫秒随机数    
    Delay delayTime

    sColor = GetPixelColor(x,y,0)
    //        TracePrint "点击后延时：" & delayTime
    Dim tryTimes = 0
    If check = True Then 
        While fColor = sColor
            tryTimes = tryTimes + 1
            ShowMessage "网络波动，5S后开始卡顿检测"
            TracePrint "网络波动，5S后开始卡顿检测"
            If type = 3 Then 
                画面卡住检测 	
            End If
            Delay 5000
            If tryTimes > 1 and not type = 3 Then 
                //卡顿检测
                TracePrint("卡顿检测")
                画面卡住检测 
            End If
            Tap x, y
            sColor = GetPixelColor(x,y,0)
        Wend
        
    End If
 
 
End Function

Sub 画面卡住检测
    
    Select Case type
    Case  2, 6, 10, 11, 12
        地下城循环 
    Case 20, 21, 22, 23, 24
        异界地下循环 
    
    Case 1
        爬塔循环 
    
    Case 3
        突袭模式 
    
    Case 4
        狗粮循环 
    Case 5
        竞技场循环 
    		    		
    End Select
    
End Sub

//无延时不检查颜色随机点击方法
Function RandomClickInRectNoDelay(minX, minY, width, height)

    Dim x,y,offset
    x = int(Rnd() * width + minX)//x的值为随机数minX - minX+width
    y = int(Rnd() * height + minY)//y的值为随机数minY - minY+height
    Tap x, y
  
End Function

//随机延时不检查颜色随机点击方法
Function RandomClickInRectNoCheck(minX, minY, width, height, times)

    Dim x,y,offset
 
    x = int(Rnd() * width + minX)//x的值为随机数minX - minX+width
    y = int(Rnd() * height + minY)//y的值为随机数minY - minY+height
    MoveToPointAndTap x, y,False
    If times = 2 Then  
        offset = int(Rnd() * 40 -20)	//在上次基础上左右各随机偏移20
        MoveToPointAndTap x+offset, y+offset,False
    End If
End Function

//帮助方法-不需要适配

Function 判断文件

    Call xy.Mount("/system")
    //这个是防止有的设备系统根目录为xbin，一般情况下都是bin目录
    // If Dir.Exist("/system/bin/ftpput") = 0 And Dir.Exist("/system/xbin/ftpput") Then 
    If Dir.Exist("/system/bin/ftpput") = 0 Then
        TracePrint "检测ftpput不存在，释放文件"'释放ftpput到设备系统bin目录
        PutAttachment "/system/bin/","ftpput"
    End If

    // If Dir.Exist("/system/bin/ftpget") = 0 And Dir.Exist("/system/xbin/ftpget") Then 
    If Dir.Exist("/system/bin/ftpget") = 0 Then '释放ftpget到设备系统bin目录
        TracePrint "检测ftpget不存在，释放文件"
        PutAttachment "/system/bin/", "ftpget"
    End If

    //下面为修改ftpput和ftpget最高权限
    Delay 100
    Call xy.Chmod("/system/bin/ftpput", 0)'设为可读写
    Delay 100
    Call xy.Cmd("chmod 7777 /system/bin/ftpput")'修改最高权限
    Delay 100
    Call xy.Chmod("/system/bin/ftpget", 0)'设为可读写
    Delay 100
    Call xy.Cmd("chmod 7777 /system/bin/ftpget")'修改最高权限
    Delay 100

End Function

Function stopTheScript()
    
    TracePrint ("成功次数:" & success & "\n失败次数:" & failure & "\n买体次数:" & buyTimes & "\n获取符文总数:" & Z5 + Z6 + L6 + C5 + C6 &_
     "\n答题正确:" & answerTrue & "\n答题错误:" & answerFalse & "\n停止原因:" & endReason)
    TracePrint GetTempDir()
    Log.Close
    EndScript
End Function

Function OnScriptExit()
    TracePrint "脚本已经停止！"
    ShowMessage "脚本已经停止！"
    If not endReason = "更新新版本~" Then 

        Dialog.MsgBox(("泰迪脚本运行结果：(①群：838134503，②群：654740867)\n" &_ 
        "成功次数：" & success & "	失败次数：" & failure & "	买体次数：" &_
     buyTimes & "\n答题正确：" & answerTrue &_
      "	答题错误：" & answerFalse &_
        "\n六星符文：" & "紫六：" & Z6 & "	蓝六：" & L6 & "	橙六：" & C6  &_
        "\n五星符文：" & "紫五：" & Z5 & "	橙五：" & C5 &_
        "\n精炼石："  & "蓝：" & SL & "	紫：" & SZ & "	橙：" & SC &_
        "\n神器："  & "蓝：" & 蓝色神器数 & "	紫：" & 紫色神器数 & "	橙：" & 橙色神器数 &_
        "\n停止原因：" & endReason) ,0) 
        
    End If
	
End Function


Function showServerError()
    Dialog.MsgBox "服务器异常~" & errorStr, 0
    endReason = "服务器异常~"
    stopTheScript        
End Function

///上传答题截图
Sub uploadSnapToServer(fileNameArr)
    判断文件 
    TracePrint "开始上传答题截图,以便优化答题正确率~" 
    Dim i
    For Each i In fileNameArr
        Dim fileName = i
        Dim localPath = dirPath & i	///上传文件的本地完整路径 
        Dim 服务器地址="39.108.123.245", 用户名="ml", 密码="486915" ,服务器文件路径 = "Pic" & fileName, 本地路径= localPath

        Delay 100
        dim sc = xy.FtpPut(服务器地址,用户名,密码,本地路径,服务器文件路径)'FTP上传 
        TracePrint "上传答题截图结果:"
        TracePrint sc
    Next

End Sub

Sub uploadRegErrorPic()
	
    ShowMessage "识别异常,上传异常截图"
    TracePrint "识别异常,上传异常截图" 
    Dim fileName = "/" & Replace(GetNetworkTime()," ","-") & "-识别异常"  &".png" 
    SnapShot dirPath & fileName
    Dim errorArr = Array(fileName)
    uploadSnapToServer errorArr
    
End Sub

Function 请求答题token
    //	Dim tokenUrl = "https://aip.baidubce.com/oauth/2.0/token?grant_type=client_credentials&client_id=0cGpXE56nFa9MchE2wNPX4xV&client_secret=gTQs2ZucmDrH4FS3IXoP2RmSDVbUwl2l"
    Dim tokenUrl = "https://aip.baidubce.com/oauth/2.0/token?grant_type=client_credentials&client_id=0cGpXE56nFa9MchE2wNPX4xV&client_secret=gTQs2ZucmDrH4FS3IXoP2RmSDVbUwl2l"
    dim result = URL.Post(tokenUrl,"")
    TracePrint result
    table = Cjson.Decode(result)
    regToken = table["access_token"]
    If regToken = "" Then 
        endReason = "初始化答题识别器失败"
        stopTheScript()
    End If
    TracePrint regToken
		
    //	Dim testPic = GetSdcardDir() & "/2020-07-18-22:05:52.png"
    //	验证答题图片 testPic
End Function


Function 验证答题图片(imgPath)

    Rem retryReg
    Dim regUrl = "https://aip.baidubce.com/rpc/2.0/ai_custom/v1/classification/regImage?access_token=" & regToken
	
    dim base64Str = ShanHai.ReadFileBase(imgPath)

    Dim data = {"image" : base64Str}
    dim Json字符串 = Encode.TableToJson(data)

    dim result = URL.Post(regUrl,Json字符串)	//	服务器返回的原数据
	
    Dim regResult = 0 //0魔灵，1-艾琳，2-boss
    TracePrint result
    If result = "" Then 
        goto retryReg
    End If
	
	
    dim json = Encode.JsonToTable(result)
    Dim results = json["results"]
    Dim firstResult = results(0)
    //    TracePrint json
    //    TracePrint results
    //     TracePrint firstResult


    For Each k ,v In firstResult
        
        If v = "alin" Then 
            regResult = 1
        End If
        
        If v = "boss" Then 
            regResult = 2
        End If
        
    Next
	
    验证答题图片 = regResult
End Function

//检查更新
Function checkUpdate()
  

    //	请求答题token 
	
    //判断是否是解绑 39.108.123.245
    Dim isUnbind = ReadUIConfig("解绑",false)

	
    If isUnbind = False Then 
        ShowMessage "检查更新"
        TracePrint "检查更新"
        
        json = URL.Get("http://39.108.123.245:4869/getVersion", 10)
        TracePrint "检查更新json:" & json 
         	
        If json = "" Then 
            ShowMessage "连接服务器失败~" & errorStr
            TracePrint "json为空"
            Delay 2000
            endReason = "服务器异常~"
            stopTheScript 
        End If
        // json数据转换table
        table = Cjson.Decode(json)
        // 输出table内容
        For Each k, v In table
            If k = "version" Then 
                ver = v
            End If
            
            If k = "code" Then 
                code = v
            End If
            
            If k = "detail" Then 
                detail = v
            End If
                
            If k = "url" Then 
                link = v
            End If
        Next
      
        If code = 0 Then 
  
            If currentVersion = ver Then 
                ShowMessage "已是最新版本,校验注册码~"
                TracePrint "已是最新版本,校验注册码~"
                Delay 2000 
                checkRegisterCode regCode
                比例判断脚本模式
            Else 
                ShowMessage "发现新版本,开始下载~"
                TracePrint "发现新版本,开始下载~"
                
                zm.OpenURL link
                Delay 1000
                Dialog.MsgBox "请在弹出的页面中点击下载:\n" & "新版本更新内容:\n"  & detail, 0
                
                endReason = "更新新版本~"
                stopTheScript
            End If

        Else     
            showServerError
        End If
    Else 
        
        ShowMessage "开始解绑"
        Delay 2000
        If Dir.Exist("/system/lib/libz") = 0 Then '释放libz到设备系统lib目录
            //此设备还未绑定
            endReason = "此设备尚未绑定,无需解绑~"
            stopTheScript 
        Else 
            Dim deviceID = File.Read("/system/lib/libz")	//拿到设备ID
            //开始解绑http://39.108.123.245:4869/unbindDevice?regCode=***&deviceID=***
            Dim reqUrl = "http://39.108.123.245:4869/unbindDevice?regCode=" & regCode & "&deviceID=" & deviceID
            //        TracePrint reqUrl
            json = URL.Get(reqUrl, 10)
            TracePrint "校验注册码json:" & json 
            If json = "" Then 
                ShowMessage "校验注册码失败~" & errorStr
                TracePrint "json为空"
                Delay 2000
                endReason = "服务器异常~"
                stopTheScript 
            End If
            // json数据转换table
            table = Cjson.Decode(json)
            // 输出table内容
            For Each k, v In table
                If k = "startTime" Then 
                    startTime = v
                End If
            
                If k = "endTime" Then 
                    endTime = v
                End If
    
                If k = "code" Then 
                    code = v
                End If
    
                If k = "detail" Then 
                    detail = v
                End If
            Next

            If code = 0 Then 
                TracePrint "解绑成功~"
				
            ElseIf code = 1 Then

                TracePrint "注册码不存在~" & errorStr
                Dialog.MsgBox("注册码不存在~" & errorStr ,0)

            
            ElseIf code = 2 Then

                TracePrint "注册码已过期~" & errorStr
                Dialog.MsgBox("注册码已过期~" & errorStr ,0)
        
            ElseIf code = 3 Then
            
                TracePrint "该注册码尚未绑定此设备~" & errorStr
                Dialog.MsgBox("该注册码尚未绑定此设备~" & errorStr ,0)
            Else 
            
                showServerError
            End If
        End If
        
    End If
   


End Function 

//检查注册码是否有效
Function checkRegisterCode(code)
	
    If code = "0" Then 
        Dialog.MsgBox "注册码为空~" & errorStr, 0
        endReason = "注册码为空~"
        stopTheScript 
		
    Else 
        If Dir.Exist("/system/lib/libz") = 0 Then '释放libz到设备系统lib目录
            //
            Dim uuid = zm.UUID()
            File.append("/system/lib/libz",uuid)
        End If
        Dim deviceID = File.Read("/system/lib/libz")
        Dim reqUrl
        If code = "123456" or code = "838134503" Then 
            //测试的注册码，不校验多开
            reqUrl = "http://39.108.123.245:4869/checkCode?code=" & code
        Else 
            reqUrl = "http://39.108.123.245:4869/checkCode?code=" & code & "&deviceID=" & deviceID
        End If
        
        //        TracePrint reqUrl
        json = URL.Get(reqUrl, 10)
        TracePrint "校验注册码json:" & json 
        If json = "" Then 
            ShowMessage "校验注册码失败~" & errorStr
            TracePrint "json为空"
            Delay 2000
            endReason = "服务器异常~"
            stopTheScript 
        End If
        // json数据转换table
        table = Cjson.Decode(json)
        // 输出table内容
        For Each k, v In table
            If k = "startTime" Then 
                startTime = v
            End If
            
            If k = "endTime" Then 
                endTime = v
            End If
    
            If k = "code" Then 
                code = v
            End If
    
            If k = "detail" Then 
                detail = v
            End If
        Next

        If code = 0 Then 
            TracePrint "注册码校验成功,开始判断脚本模式"
            ShowMessage "到期时间：" & endTime
            Delay 2000
            比例判断脚本模式
        ElseIf code = 1 Then

            TracePrint "注册码不存在~" & errorStr
            Dialog.MsgBox("注册码不存在~，" & errorStr ,0)
			endReason = "注册码不存在~，" & errorStr
            stopTheScript 
            
        ElseIf code = 2 Then

            TracePrint "注册码已过期~" & errorStr
            Dialog.MsgBox "注册码已过期~" & errorStr, 0
            endReason = "注册码已过期~" & errorStr
        	stopTheScript
        ElseIf code = 3 Then
            
            TracePrint "注册码超过可绑定设备数量~" & errorStr
            Dialog.MsgBox "注册码超过可绑定设备数量~" & errorStr, 0
            endReason = "注册码超过可绑定设备数量~" & errorStr
        	stopTheScript
        Else 
            
            showServerError
        End If
    End If
	
End Function
